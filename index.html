<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Gym Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet"/>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:        #080808;
  --surface:   #101010;
  --surface2:  #161616;
  --surface3:  #1c1c1c;
  --border:    #1e1e1e;
  --border2:   #2a2a2a;
  --text:      #f2f2f2;
  --text2:     #888;
  --text3:     #3a3a3a;
  --accent:    #ff1e00;
  --accent-glow: rgba(255,30,0,.18);
  --green:     #00e676;
  --green-dim: rgba(0,230,118,.12);
  --amber:     #ffb300;
  --amber-dim: rgba(255,179,0,.12);
  --red:       #ff1e00;
  --red-dim:   rgba(255,30,0,.12);
  --shadow:    0 2px 12px rgba(0,0,0,.6);
  --shadow-lg: 0 16px 48px rgba(0,0,0,.8);
}
:root[data-theme="light"] {
  --bg:        #f7f7f5;
  --surface:   #ffffff;
  --surface2:  #f0f0ee;
  --surface3:  #e8e8e6;
  --border:    #e0e0dd;
  --border2:   #c8c8c4;
  --text:      #0a0a0a;
  --text2:     #666;
  --text3:     #c0c0bc;
  --accent:    #ff1e00;
  --accent-glow: rgba(255,30,0,.1);
  --green:     #009c4a;
  --green-dim: rgba(0,156,74,.1);
  --amber:     #c87d00;
  --amber-dim: rgba(200,125,0,.1);
  --red:       #e00000;
  --red-dim:   rgba(224,0,0,.1);
  --shadow:    0 2px 12px rgba(0,0,0,.08);
  --shadow-lg: 0 16px 48px rgba(0,0,0,.14);
}

/* ── BASE ── */
body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Outfit', sans-serif;
  font-size: 14px;
  line-height: 1.5;
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
  overflow-x: hidden;
}

/* Noise texture overlay */
body::before {
  content: '';
  position: fixed; inset: 0; z-index: 0; pointer-events: none;
  opacity: .025;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  background-size: 128px 128px;
}

#wrap { position: relative; z-index: 1; }

/* ── ALERT BANNER ── */
#g-alert {
  display: none; position: fixed; top: 0; left: 0; right: 0; z-index: 999;
  padding: 14px 32px; align-items: center; justify-content: space-between; gap: 12px;
  font-size: 13px; font-weight: 500;
  animation: slideDown .35s cubic-bezier(.16,1,.3,1);
}
#g-alert.danger { background: var(--accent); color: #fff; }
#g-alert.warn   { background: var(--amber); color: #000; }
@keyframes slideDown { from{transform:translateY(-100%)} to{transform:translateY(0)} }
.ga-left { display: flex; align-items: center; gap: 10px; }
.ga-right { display: flex; align-items: center; gap: 8px; }
.ga-btn {
  background: rgba(255,255,255,.2); border: 1px solid rgba(255,255,255,.3);
  color: inherit; font-family: 'Outfit', sans-serif; font-size: 12px; font-weight: 600;
  padding: 5px 16px; border-radius: 40px; cursor: pointer; transition: .15s;
}
.ga-btn:hover { background: rgba(255,255,255,.3); }
.ga-x { background: none; border: none; color: rgba(255,255,255,.6); font-size: 20px; cursor: pointer; line-height: 1; padding: 0 4px; }

/* ── MODAL ── */
.overlay {
  display: none; position: fixed; inset: 0; z-index: 998;
  background: rgba(0,0,0,.75); backdrop-filter: blur(12px);
  align-items: center; justify-content: center; padding: 20px;
}
.overlay.open { display: flex; }
.modal {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: 20px; padding: 40px;
  max-width: 460px; width: 100%;
  box-shadow: var(--shadow-lg);
  animation: fadeUp .35s cubic-bezier(.16,1,.3,1);
}
@keyframes fadeUp { from{opacity:0;transform:translateY(24px) scale(.97)} to{opacity:1;transform:translateY(0) scale(1)} }
.modal-eyebrow {
  font-size: 11px; font-weight: 700; color: var(--accent);
  letter-spacing: .12em; text-transform: uppercase; margin-bottom: 8px;
}
.modal-title { font-family: 'Bebas Neue', sans-serif; font-size: 40px; letter-spacing: 1px; margin-bottom: 6px; }
.modal-sub { font-size: 13px; color: var(--text2); margin-bottom: 24px; }
.modal-list { display: flex; flex-direction: column; gap: 8px; margin-bottom: 28px; }
.modal-item {
  display: flex; justify-content: space-between; align-items: center;
  padding: 14px 18px; border-radius: 12px; border: 1px solid;
}
.modal-item.danger { background: var(--red-dim); border-color: rgba(255,30,0,.3); }
.modal-item.warn   { background: var(--amber-dim); border-color: rgba(255,179,0,.3); }
.mi-name { font-size: 15px; font-weight: 600; }
.mi-meta { font-size: 11px; color: var(--text2); margin-top: 2px; }
.mi-amt { font-size: 20px; font-weight: 700; font-family: 'JetBrains Mono', monospace; }
.mi-tag { font-size: 10px; font-weight: 700; padding: 3px 10px; border-radius: 40px; margin-top: 4px; letter-spacing: .06em; text-transform: uppercase; }
.mi-tag.danger { background: var(--red); color: #fff; }
.mi-tag.warn   { background: var(--amber); color: #000; }
.modal-footer  { display: flex; gap: 8px; }
.mbtn {
  font-family: 'Outfit', sans-serif; font-size: 14px; font-weight: 700;
  padding: 12px 28px; border-radius: 40px; cursor: pointer; transition: all .2s; border: none;
}
.mbtn.primary { background: var(--text); color: var(--bg); }
.mbtn.primary:hover { transform: scale(1.02); }
.mbtn.secondary { background: transparent; color: var(--text2); border: 1px solid var(--border2); }
.mbtn.secondary:hover { border-color: var(--text2); color: var(--text); }

/* ── HEADER ── */
header {
  position: sticky; top: 0; z-index: 100;
  background: rgba(8,8,8,.92);
  backdrop-filter: blur(20px) saturate(1.5);
  border-bottom: 1px solid var(--border);
}
:root[data-theme="light"] header {
  background: rgba(247,247,245,.92);
}
.header-inner {
  max-width: 1100px; margin: 0 auto;
  padding: 0 36px; height: 64px;
  display: flex; align-items: center; justify-content: space-between;
}
.brand {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 26px; letter-spacing: 2px;
  display: flex; align-items: center; gap: 10px;
}
.brand-swoosh {
  width: 32px; height: 12px;
  background: var(--accent);
  clip-path: path('M0,10 C8,0 20,-2 32,4 C22,6 12,10 0,10 Z');
}
.header-right { display: flex; align-items: center; gap: 12px; }
.theme-switch {
  display: flex; background: var(--surface2);
  border: 1px solid var(--border2); border-radius: 40px;
  overflow: hidden; cursor: pointer; padding: 3px;
}
.ts-opt {
  padding: 5px 16px; font-size: 11px; font-weight: 600; color: var(--text2);
  transition: .2s; cursor: pointer; user-select: none; border-radius: 40px;
}
.ts-opt.active { background: var(--text); color: var(--bg); }

/* ── NAV ── */
nav { border-bottom: 1px solid var(--border); background: var(--bg); }
.nav-inner {
  max-width: 1100px; margin: 0 auto;
  padding: 0 36px; display: flex; gap: 0; overflow-x: auto;
}
.tab {
  padding: 16px 20px; font-size: 13px; font-weight: 600; color: var(--text3);
  border: none; background: transparent; cursor: pointer;
  border-bottom: 2px solid transparent; margin-bottom: -1px;
  transition: all .2s; white-space: nowrap; position: relative;
  letter-spacing: .01em;
}
.tab:hover { color: var(--text2); }
.tab.active { color: var(--text); border-bottom-color: var(--accent); }
.tab-dot {
  position: absolute; top: 12px; right: 8px;
  width: 5px; height: 5px; border-radius: 50%;
  background: var(--accent);
  box-shadow: 0 0 6px var(--accent);
}

/* ── MAIN ── */
.main { max-width: 1100px; margin: 0 auto; padding: 48px 36px 100px; }
.section { display: none; }
.section.active { display: block; animation: sectionIn .4s cubic-bezier(.16,1,.3,1) both; }
@keyframes sectionIn { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)} }

/* ── PAGE HEADER ── */
.page-header { margin-bottom: 48px; }
.page-label {
  font-size: 11px; font-weight: 700; color: var(--accent);
  letter-spacing: .14em; text-transform: uppercase; margin-bottom: 6px;
}
.page-title {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 72px; letter-spacing: 2px; line-height: .9;
  color: var(--text);
}

/* ── GRID ── */
.g2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
@media(max-width:700px){ .g2 { grid-template-columns: 1fr; } }

/* ── CARD ── */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px; padding: 28px;
  margin-bottom: 14px;
  transition: border-color .2s, box-shadow .2s;
}
.card:hover { border-color: var(--border2); }
.card-label {
  font-size: 10px; font-weight: 700; color: var(--text2);
  letter-spacing: .14em; text-transform: uppercase;
  margin-bottom: 20px; padding-bottom: 14px; border-bottom: 1px solid var(--border);
}

/* ── STAT ROW ── */
.stat-row { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 28px; }
.stat {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px; padding: 22px 20px; flex: 1; min-width: 80px;
  position: relative; overflow: hidden; transition: border-color .2s;
}
.stat:hover { border-color: var(--border2); }
.stat-glow {
  position: absolute; top: -30px; left: -20px;
  width: 100px; height: 100px; border-radius: 50%; filter: blur(40px);
  pointer-events: none; opacity: .7;
}
.stat:nth-child(1) .stat-glow { background: var(--green); }
.stat:nth-child(2) .stat-glow { background: var(--amber); }
.stat:nth-child(3) .stat-glow { background: var(--red); }
.stat-n {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 56px; letter-spacing: 1px; line-height: 1; position: relative;
}
.stat-n.g { color: var(--green); }
.stat-n.a { color: var(--amber); }
.stat-n.r { color: var(--red); }
.stat-l { font-size: 11px; color: var(--text2); font-weight: 600; margin-top: 4px; letter-spacing: .06em; text-transform: uppercase; }

/* ── YEAR NAV ── */
.yn { display: flex; align-items: center; gap: 8px; }
.yn-btn {
  background: var(--surface2); border: 1px solid var(--border2);
  color: var(--text2); font-family: 'Outfit', sans-serif;
  font-size: 16px; font-weight: 600;
  width: 34px; height: 34px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; transition: all .15s;
}
.yn-btn:hover { border-color: var(--text2); color: var(--text); background: var(--surface3); }
.yn-val { font-family: 'JetBrains Mono', monospace; font-size: 16px; font-weight: 500; min-width: 52px; text-align: center; }

/* ── LEGEND ── */
.legend { display: flex; gap: 20px; flex-wrap: wrap; align-items: center; margin-bottom: 24px; }
.leg { display: flex; align-items: center; gap: 7px; font-size: 12px; font-weight: 600; color: var(--text2); }
.leg-dot { width: 8px; height: 8px; border-radius: 3px; flex-shrink: 0; }
.leg-dot.g { background: var(--green); box-shadow: 0 0 6px var(--green); }
.leg-dot.a { background: var(--amber); box-shadow: 0 0 6px var(--amber); }
.leg-dot.r { background: var(--red); box-shadow: 0 0 6px var(--red); }
.leg-hint { font-size: 11px; color: var(--text3); margin-left: auto; font-weight: 500; }

/* ── TOP ROW ── */
.top-row { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px; margin-bottom: 24px; }

/* ── MONTH GRID ── */
#months-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(268px, 1fr)); gap: 12px; }
.mc {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 16px; padding: 20px;
  transition: border-color .2s, transform .2s;
}
.mc:hover { border-color: var(--border2); }
.mc.cur { border-color: var(--accent); box-shadow: 0 0 0 1px var(--accent), 0 0 20px var(--accent-glow); }
.mc-head { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 14px; }
.mc-name { font-family: 'Bebas Neue', sans-serif; font-size: 18px; letter-spacing: 1px; color: var(--text2); }
.mc-name.c { color: var(--text); }
.mc-mini { display: flex; gap: 8px; margin-top: 3px; }
.mc-mini span { font-size: 10px; font-family: 'JetBrains Mono', monospace; font-weight: 500; }
.cur-tag {
  font-size: 9px; font-weight: 700; letter-spacing: .1em; text-transform: uppercase;
  background: var(--accent); color: #fff;
  padding: 3px 10px; border-radius: 40px;
  box-shadow: 0 0 12px var(--accent-glow);
}
.dow-row { display: grid; grid-template-columns: repeat(7, 28px); gap: 2px; margin-bottom: 4px; }
.dow-c { width: 28px; text-align: center; font-size: 9px; color: var(--text3); font-weight: 700; letter-spacing: .02em; text-transform: uppercase; }
.dg { display: grid; grid-template-columns: repeat(7, 28px); gap: 2px; }
.dc {
  width: 28px; height: 26px; border-radius: 6px;
  display: flex; align-items: center; justify-content: center;
  font-size: 10px; font-weight: 600; color: var(--text3);
  cursor: pointer; transition: all .12s; user-select: none;
  font-family: 'JetBrains Mono', monospace;
}
.dc:hover { background: var(--surface3); color: var(--text2); transform: scale(1.1); }
.dc.empty { opacity: 0; pointer-events: none; }
.dc.green  { background: var(--green-dim); color: var(--green); }
.dc.yellow { background: var(--amber-dim); color: var(--amber); }
.dc.red    { background: var(--red-dim);   color: var(--red); }
.dc.today  { box-shadow: 0 0 0 1.5px var(--accent); color: var(--text); }

/* ── FORM ── */
.frow { display: flex; gap: 8px; margin-bottom: 10px; flex-wrap: wrap; }
.inp {
  flex: 1; min-width: 100px;
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: 10px; color: var(--text);
  font-family: 'Outfit', sans-serif; font-size: 14px;
  padding: 11px 16px; outline: none; transition: all .2s;
}
.inp:focus { border-color: var(--accent); background: var(--surface); box-shadow: 0 0 0 3px var(--accent-glow); }
.inp::placeholder { color: var(--text3); }
textarea.inp { resize: vertical; min-height: 60px; }
.btn-primary {
  background: var(--text); color: var(--bg); border: none;
  font-family: 'Outfit', sans-serif;
  font-size: 13px; font-weight: 700;
  padding: 11px 22px; border-radius: 40px; cursor: pointer; transition: all .2s;
  white-space: nowrap; letter-spacing: .02em;
}
.btn-primary:hover { transform: scale(1.03); opacity: .9; }
.btn-del {
  background: none; border: none; color: var(--text3);
  cursor: pointer; font-size: 16px; padding: 4px 8px;
  transition: all .15s; line-height: 1; border-radius: 8px;
}
.btn-del:hover { color: var(--red); background: var(--red-dim); }

/* ── LOG ── */
.log { display: flex; flex-direction: column; gap: 4px; max-height: 280px; overflow-y: auto; }
.log-row {
  display: flex; justify-content: space-between; align-items: center;
  padding: 12px 14px; border-radius: 10px; font-size: 13px;
  background: var(--surface2); transition: all .15s; border: 1px solid transparent;
}
.log-row:hover { background: var(--surface3); border-color: var(--border2); }
.lr-l { display: flex; flex-direction: column; gap: 1px; }
.lr-val { font-weight: 700; font-family: 'JetBrains Mono', monospace; font-size: 14px; }
.lr-note { font-size: 11px; color: var(--text2); }
.lr-date { font-size: 10px; color: var(--text3); margin-top: 1px; font-family: 'JetBrains Mono', monospace; }

/* ── WEIGHT ── */
.w-stats { display: grid; grid-template-columns: repeat(3,1fr); gap: 8px; margin-bottom: 16px; }
.ws {
  background: var(--surface2); border-radius: 12px;
  padding: 16px 12px; text-align: center; border: 1px solid var(--border);
}
.ws-n { font-family: 'Bebas Neue', sans-serif; font-size: 32px; letter-spacing: 1px; }
.ws-l { font-size: 10px; color: var(--text3); font-weight: 700; margin-top: 4px; letter-spacing: .08em; text-transform: uppercase; }
.chart-box { width: 100%; height: 140px; position: relative; }

/* ── DIET STATUS ── */
.dst-row { display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; }
.dst-btn {
  flex: 1; padding: 12px 8px; border-radius: 12px;
  border: 1px solid var(--border); background: var(--surface2);
  color: var(--text2); font-family: 'Outfit', sans-serif;
  font-size: 13px; font-weight: 600;
  cursor: pointer; transition: all .2s; text-align: center;
}
.dst-btn:hover { border-color: var(--border2); }
.dst-btn.sg { background: var(--green-dim); border-color: rgba(0,230,118,.4); color: var(--green); }
.dst-btn.sa { background: var(--amber-dim); border-color: rgba(255,179,0,.4); color: var(--amber); }
.dst-btn.sr { background: var(--red-dim);   border-color: rgba(255,30,0,.4);   color: var(--red); }
.dcal-head { display: grid; grid-template-columns: repeat(7,1fr); gap: 2px; margin-bottom: 5px; }
.dcal-dow { text-align: center; font-size: 9px; font-weight: 700; color: var(--text3); letter-spacing: .04em; text-transform: uppercase; }
.dcal-grid { display: grid; grid-template-columns: repeat(7,1fr); gap: 3px; }
.ddot { aspect-ratio: 1; border-radius: 5px; background: var(--surface2); border: 1px solid var(--border); }
.ddot.green  { background: var(--green-dim); border-color: rgba(0,230,118,.35); }
.ddot.yellow { background: var(--amber-dim); border-color: rgba(255,179,0,.35); }
.ddot.red    { background: var(--red-dim);   border-color: rgba(255,30,0,.35); }

.dlog { padding: 12px 14px; border-radius: 10px; background: var(--surface2); margin-bottom: 4px; transition: all .15s; border: 1px solid transparent; }
.dlog:hover { background: var(--surface3); border-color: var(--border2); }
.dlog-head { display: flex; justify-content: space-between; align-items: center; }
.dlog-date { font-size: 10px; color: var(--text3); font-weight: 600; font-family: 'JetBrains Mono', monospace; }
.dlog-badge { font-size: 10px; font-weight: 700; padding: 3px 10px; border-radius: 40px; letter-spacing: .04em; text-transform: uppercase; }
.dlog-badge.green  { background: var(--green-dim); color: var(--green); }
.dlog-badge.yellow { background: var(--amber-dim); color: var(--amber); }
.dlog-badge.red    { background: var(--red-dim);   color: var(--red); }
.dlog-food  { font-size: 12px; color: var(--text2); margin-top: 5px; }
.dlog-notes { font-size: 11px; color: var(--text3); margin-top: 2px; }

/* ── PAYMENTS ── */
.pay-item {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 14px; padding: 16px 20px; margin-bottom: 8px;
  display: flex; align-items: center; gap: 14px;
  transition: all .2s;
}
.pay-item:hover { border-color: var(--border2); }
.pay-item.urgent { border-color: rgba(255,30,0,.4); background: var(--red-dim); }
.pay-item.soon   { border-color: rgba(255,179,0,.4); }
.p-l { flex: 1; }
.p-name { font-size: 15px; font-weight: 600; }
.p-meta { font-size: 11px; color: var(--text3); margin-top: 3px; font-family: 'JetBrains Mono', monospace; }
.p-r { display: flex; flex-direction: column; align-items: flex-end; gap: 6px; }
.p-amt { font-family: 'JetBrains Mono', monospace; font-size: 22px; font-weight: 700; letter-spacing: -.5px; }
.p-tag { font-size: 10px; font-weight: 700; padding: 3px 12px; border-radius: 40px; letter-spacing: .06em; text-transform: uppercase; }
.p-tag.danger { background: var(--red); color: #fff; box-shadow: 0 0 10px var(--accent-glow); }
.p-tag.warn   { background: var(--amber); color: #000; }
.p-tag.ok     { background: var(--surface2); color: var(--text3); border: 1px solid var(--border2); }
.p-acts { display: flex; gap: 6px; align-items: center; }
.btn-paid {
  background: var(--green-dim); border: 1px solid rgba(0,230,118,.3);
  color: var(--green);
  font-family: 'Outfit', sans-serif; font-size: 11px; font-weight: 700;
  padding: 5px 14px; border-radius: 40px; cursor: pointer; transition: all .2s;
  letter-spacing: .04em;
}
.btn-paid:hover { background: var(--green); color: #000; }
.rcbtn-row { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px; }
.rcbtn {
  padding: 8px 18px; border-radius: 40px;
  border: 1px solid var(--border); background: var(--surface2);
  color: var(--text2); font-family: 'Outfit', sans-serif;
  font-size: 12px; font-weight: 600;
  cursor: pointer; transition: all .2s;
}
.rcbtn.active { background: var(--text); color: var(--bg); border-color: var(--text); }
.rcbtn:hover:not(.active) { border-color: var(--border2); color: var(--text); }

/* ── ROUTINE ── */
.today-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 20px; padding: 36px;
  margin-bottom: 14px;
  position: relative; overflow: hidden;
}
.today-card::before {
  content: '';
  position: absolute; bottom: -60px; right: -60px;
  width: 240px; height: 240px;
  background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%);
  pointer-events: none;
}
.tc-label { font-size: 11px; color: var(--text3); font-weight: 700; letter-spacing: .12em; text-transform: uppercase; margin-bottom: 4px; }
.tc-day { font-family: 'Bebas Neue', sans-serif; font-size: 56px; letter-spacing: 2px; margin-bottom: 20px; line-height: 1; }
.ex-list { display: flex; flex-direction: column; gap: 4px; }
.ex-chip {
  background: var(--surface2); border-radius: 10px; padding: 12px 16px;
  display: flex; align-items: center; gap: 14px; font-size: 13px; font-weight: 500;
  border: 1px solid var(--border); transition: all .15s;
}
.ex-chip:hover { background: var(--surface3); border-color: var(--border2); transform: translateX(4px); }
.ex-n { font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--accent); min-width: 20px; font-weight: 700; }
.dtab-row { display: flex; gap: 4px; flex-wrap: wrap; margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid var(--border); }
.dtab {
  padding: 7px 16px; border-radius: 40px;
  border: 1px solid transparent; background: transparent;
  color: var(--text3); font-family: 'Outfit', sans-serif;
  font-size: 12px; font-weight: 600;
  cursor: pointer; transition: all .2s;
}
.dtab.active { background: var(--surface2); border-color: var(--border2); color: var(--text); }
.dtab:hover:not(.active) { color: var(--text2); }
.ex-editor { display: flex; flex-direction: column; gap: 4px; margin-bottom: 12px; max-height: 220px; overflow-y: auto; }
.ex-row { display: flex; gap: 6px; align-items: center; }

/* ── EMPTY ── */
.empty { text-align: center; padding: 40px; color: var(--text3); font-size: 13px; font-weight: 500; }

/* ── FOOTER ── */
footer { border-top: 1px solid var(--border); margin-top: 80px; padding: 24px 36px; }
.footer-inner { max-width: 1100px; margin: 0 auto; font-size: 11px; color: var(--text3); text-align: center; letter-spacing: .06em; font-weight: 600; text-transform: uppercase; }

/* ── LABEL ── */
.field-label { font-size: 11px; font-weight: 700; color: var(--text2); letter-spacing: .08em; text-transform: uppercase; margin-bottom: 8px; }

/* ── SCROLLBAR ── */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 4px; }
::-webkit-scrollbar-track { background: transparent; }
</style>
</head>
<body>

<!-- ALERT BANNER -->
<div id="g-alert" style="display:none">
  <div class="ga-left">
    <span id="ga-icon"></span>
    <div>
      <strong id="ga-title" style="display:block;font-size:14px;font-weight:700"></strong>
      <span id="ga-body" style="opacity:.85;font-size:12px"></span>
    </div>
  </div>
  <div class="ga-right">
    <button class="ga-btn" onclick="showTab('pagos');closeAlert()">Ver pagos</button>
    <button class="ga-x" onclick="closeAlert()">✕</button>
  </div>
</div>

<!-- MODAL -->
<div class="overlay" id="pay-modal">
  <div class="modal">
    <div class="modal-eyebrow">Alerta de pago</div>
    <div class="modal-title" id="modal-title"></div>
    <div class="modal-sub" id="modal-sub"></div>
    <div class="modal-list" id="modal-list"></div>
    <div class="modal-footer">
      <button class="mbtn primary" onclick="showTab('pagos');closeModal()">Ver pagos</button>
      <button class="mbtn secondary" onclick="closeModal()">Cerrar</button>
    </div>
  </div>
</div>

<div id="wrap">

<header>
  <div class="header-inner">
    <div class="brand">
      <div class="brand-swoosh"></div>
      GYM TRACKER
    </div>
    <div class="header-right">
      <div class="theme-switch" onclick="toggleTheme()">
        <span id="th-light" class="ts-opt">Claro</span>
        <span id="th-dark" class="ts-opt active">Oscuro</span>
      </div>
    </div>
  </div>
</header>

<nav>
  <div class="nav-inner">
    <button class="tab active" onclick="showTab('gym')">Entrenos</button>
    <button class="tab" onclick="showTab('rutina')">Rutina</button>
    <button class="tab" id="tab-pagos" onclick="showTab('pagos')">Pagos</button>
    <button class="tab" onclick="showTab('peso')">Peso</button>
    <button class="tab" onclick="showTab('dieta')">Dieta</button>
  </div>
</nav>

<main class="main">

  <!-- GYM -->
  <div id="sec-gym" class="section active">
    <div class="page-header">
      <div class="page-label">Registro anual</div>
      <div class="page-title">MIS<br>ENTRENOS</div>
    </div>
    <div class="top-row">
      <div class="legend">
        <div class="leg"><div class="leg-dot g"></div>Fui</div>
        <div class="leg"><div class="leg-dot a"></div>A medias</div>
        <div class="leg"><div class="leg-dot r"></div>No fui</div>
        <span class="leg-hint">Click para cambiar</span>
      </div>
      <div class="yn">
        <button class="yn-btn" onclick="changeYear(-1)">←</button>
        <span id="year-display" class="yn-val"></span>
        <button class="yn-btn" onclick="changeYear(1)">→</button>
      </div>
    </div>
    <div class="stat-row">
      <div class="stat">
        <div class="stat-glow"></div>
        <div class="stat-n g" id="sg">0</div>
        <div class="stat-l">Fui al gym</div>
      </div>
      <div class="stat">
        <div class="stat-glow"></div>
        <div class="stat-n a" id="sy">0</div>
        <div class="stat-l">A medias</div>
      </div>
      <div class="stat">
        <div class="stat-glow"></div>
        <div class="stat-n r" id="sr">0</div>
        <div class="stat-l">No fui</div>
      </div>
    </div>
    <div id="months-grid"></div>
  </div>

  <!-- RUTINA -->
  <div id="sec-rutina" class="section">
    <div class="page-header">
      <div class="page-label">Programa semanal</div>
      <div class="page-title">MI<br>RUTINA</div>
    </div>
    <div class="today-card">
      <div class="tc-label">Hoy</div>
      <div class="tc-day" id="today-day-name"></div>
      <div id="today-exercises"></div>
    </div>
    <div class="card">
      <div class="card-label">Editar días</div>
      <div class="dtab-row" id="day-tabs"></div>
      <div style="font-size:11px;color:var(--text2);font-weight:700;letter-spacing:.08em;text-transform:uppercase;margin-bottom:10px" id="editing-day-label"></div>
      <div class="ex-editor" id="exercise-editor"></div>
      <div class="frow">
        <input type="text" id="new-ex-input" class="inp" placeholder="Ej: Press banca 4×10, Sentadilla 3×12…"/>
        <button class="btn-primary" onclick="addExercise()">Agregar</button>
      </div>
    </div>
    <div class="card">
      <div class="card-label">Vista semanal</div>
      <div id="full-week" style="display:flex;flex-direction:column;gap:4px"></div>
    </div>
  </div>

  <!-- PAGOS -->
  <div id="sec-pagos" class="section">
    <div class="page-header">
      <div class="page-label">Recordatorios</div>
      <div class="page-title">MIS<br>PAGOS</div>
    </div>
    <div class="g2">
      <div>
        <div class="card">
          <div class="card-label">Nuevo pago</div>
          <div class="frow"><input type="text" id="pay-name" class="inp" placeholder="Nombre  —  ej. Cuota gym"/></div>
          <div class="frow">
            <input type="number" id="pay-amount" class="inp" placeholder="Monto" min="0" step="0.01"/>
            <input type="text" id="pay-currency" class="inp" placeholder="$" value="$" style="max-width:52px"/>
          </div>
          <div class="frow"><input type="date" id="pay-date" class="inp"/></div>
          <div class="field-label" style="margin-top:4px">Repetición</div>
          <div class="rcbtn-row">
            <button class="rcbtn active" onclick="selRecur('none',this)">Una vez</button>
            <button class="rcbtn" onclick="selRecur('monthly',this)">Mensual</button>
            <button class="rcbtn" onclick="selRecur('bimonthly',this)">Bimestral</button>
            <button class="rcbtn" onclick="selRecur('yearly',this)">Anual</button>
          </div>
          <div class="frow"><textarea id="pay-notes" class="inp" placeholder="Notas (opcional)"></textarea></div>
          <button class="btn-primary" style="width:100%" onclick="addPayment()">Agregar pago</button>
        </div>
      </div>
      <div>
        <div class="card">
          <div class="card-label">Próximos pagos</div>
          <div id="pay-list"><div class="empty">Sin pagos registrados</div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- PESO -->
  <div id="sec-peso" class="section">
    <div class="page-header">
      <div class="page-label">Control corporal</div>
      <div class="page-title">MI<br>PESO</div>
    </div>
    <div class="g2">
      <div>
        <div class="card">
          <div class="card-label">Nuevo registro</div>
          <div class="frow">
            <input type="date" id="w-date" class="inp"/>
            <input type="number" id="w-kg" class="inp" placeholder="kg" step="0.1" min="30" max="300"/>
          </div>
          <div class="frow">
            <input type="text" id="w-note" class="inp" placeholder="Nota (opcional)"/>
            <button class="btn-primary" onclick="addWeight()">Guardar</button>
          </div>
        </div>
        <div class="card">
          <div class="card-label">Resumen</div>
          <div class="w-stats">
            <div class="ws"><div class="ws-n" id="w-cur">—</div><div class="ws-l">Actual</div></div>
            <div class="ws"><div class="ws-n" id="w-min">—</div><div class="ws-l">Mínimo</div></div>
            <div class="ws"><div class="ws-n" id="w-max">—</div><div class="ws-l">Máximo</div></div>
          </div>
          <div id="w-change" style="font-size:12px;color:var(--text2);text-align:center;font-family:'JetBrains Mono',monospace;margin-top:8px"></div>
        </div>
      </div>
      <div>
        <div class="card">
          <div class="card-label">Evolución</div>
          <div class="chart-box"><canvas id="wChart"></canvas></div>
        </div>
        <div class="card">
          <div class="card-label">Historial</div>
          <div class="log" id="w-list"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- DIETA -->
  <div id="sec-dieta" class="section">
    <div class="page-header">
      <div class="page-label">Nutrición</div>
      <div class="page-title">MI<br>DIETA</div>
    </div>
    <div class="g2">
      <div>
        <div class="card">
          <div class="card-label">Registrar día</div>
          <div class="frow"><input type="date" id="d-date" class="inp"/></div>
          <div class="field-label">¿Seguiste la dieta hoy?</div>
          <div class="dst-row">
            <button class="dst-btn" id="dsb-green" onclick="selDS('green')">✓ Sí, completa</button>
            <button class="dst-btn" id="dsb-yellow" onclick="selDS('yellow')">~ A medias</button>
            <button class="dst-btn" id="dsb-red" onclick="selDS('red')">✕ No seguí</button>
          </div>
          <div class="frow" style="margin-top:4px"><textarea id="d-food" class="inp" placeholder="¿Qué comiste?"></textarea></div>
          <div class="frow">
            <textarea id="d-notes" class="inp" placeholder="Notas…" style="min-height:46px"></textarea>
            <button class="btn-primary" onclick="addDiet()" style="align-self:flex-end">Guardar</button>
          </div>
        </div>
        <div class="card">
          <div class="card-label" style="display:flex;justify-content:space-between;align-items:center">
            Stats del año
            <div class="yn">
              <button class="yn-btn" onclick="chDietY(-1)">←</button>
              <span id="d-year" class="yn-val" style="font-size:14px"></span>
              <button class="yn-btn" onclick="chDietY(1)">→</button>
            </div>
          </div>
          <div class="stat-row" style="margin-bottom:0">
            <div class="stat"><div class="stat-glow"></div><div class="stat-n g" id="ds-g" style="font-size:40px">0</div><div class="stat-l">Completa</div></div>
            <div class="stat"><div class="stat-glow"></div><div class="stat-n a" id="ds-y" style="font-size:40px">0</div><div class="stat-l">A medias</div></div>
            <div class="stat"><div class="stat-glow"></div><div class="stat-n r" id="ds-r" style="font-size:40px">0</div><div class="stat-l">No seguí</div></div>
          </div>
        </div>
      </div>
      <div>
        <div class="card">
          <div class="card-label" style="display:flex;justify-content:space-between;align-items:center;border-bottom:none;margin-bottom:12px;padding-bottom:0">
            <span id="d-month-lbl" style="font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:1px;color:var(--text)"></span>
            <div class="yn" style="gap:6px">
              <button class="yn-btn" style="width:28px;height:28px;font-size:14px" onclick="chDietM(-1)">←</button>
              <button class="yn-btn" style="width:28px;height:28px;font-size:14px" onclick="chDietM(1)">→</button>
            </div>
          </div>
          <div class="dcal-head"><div class="dcal-dow">Lu</div><div class="dcal-dow">Ma</div><div class="dcal-dow">Mi</div><div class="dcal-dow">Ju</div><div class="dcal-dow">Vi</div><div class="dcal-dow">Sá</div><div class="dcal-dow">Do</div></div>
          <div class="dcal-grid" id="d-cal"></div>
        </div>
        <div class="card">
          <div class="card-label">Historial reciente</div>
          <div class="log" id="d-list"></div>
        </div>
      </div>
    </div>
  </div>

</main>

<footer>
  <div class="footer-inner">Datos guardados en tu navegador</div>
</footer>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<script>
const MONTHS    = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
const DOW       = ["Lu","Ma","Mi","Ju","Vi","Sá","Do"];
const DAY_NAMES = ["Lunes","Martes","Miércoles","Jueves","Viernes","Sábado","Domingo"];
const CYCLE     = [null,"green","yellow","red"];
const K         = {gym:"gt-gym",w:"gt-weight",d:"gt-diet",th:"gt-theme",pay:"gt-pay",rut:"gt-rutina"};
const RECUR_LBL = {none:"Una sola vez",monthly:"Mensual",bimonthly:"Cada 2 meses",yearly:"Anual"};

let gymD={},wD=[],dD={},payD=[],rutD={};
let gYear=new Date().getFullYear();
let dYear=new Date().getFullYear(),dMonth=new Date().getMonth();
let dStatus=null,selRecurVal="none";
let wChart=null,editingDay=0;

function load(){
  try{gymD=JSON.parse(localStorage.getItem(K.gym)||"{}");}catch(_){}
  try{wD=JSON.parse(localStorage.getItem(K.w)||"[]");}catch(_){}
  try{dD=JSON.parse(localStorage.getItem(K.d)||"{}");}catch(_){}
  try{payD=JSON.parse(localStorage.getItem(K.pay)||"[]");}catch(_){}
  try{rutD=JSON.parse(localStorage.getItem(K.rut)||"{}");}catch(_){}
  applyTheme(localStorage.getItem(K.th)||"dark");
}
function sv(k,v){localStorage.setItem(k,JSON.stringify(v));}
function daysIn(y,m){return new Date(y,m+1,0).getDate();}
function firstDay(y,m){let d=new Date(y,m,1).getDay();return d===0?6:d-1;}

function applyTheme(th){
  document.documentElement.setAttribute("data-theme",th);
  localStorage.setItem(K.th,th);
  document.getElementById("th-light").classList.toggle("active",th==="light");
  document.getElementById("th-dark").classList.toggle("active",th==="dark");
}
function toggleTheme(){
  applyTheme(document.documentElement.getAttribute("data-theme")==="light"?"dark":"light");
  renderWChart();
}

function showTab(t){
  ["gym","rutina","pagos","peso","dieta"].forEach(s=>document.getElementById("sec-"+s).classList.toggle("active",s===t));
  document.querySelectorAll(".tab").forEach((b,i)=>b.classList.toggle("active",["gym","rutina","pagos","peso","dieta"][i]===t));
  if(t==="peso")  renderW();
  if(t==="dieta") renderD();
  if(t==="pagos") renderPayments();
  if(t==="rutina")renderRutina();
}

function getDaysUntil(ds){const t=new Date();t.setHours(0,0,0,0);return Math.round((new Date(ds+"T00:00:00")-t)/864e5);}
function nextOccurrence(ds,recur){
  const today=new Date();today.setHours(0,0,0,0);
  let d=new Date(ds+"T00:00:00");
  if(recur==="none")return d;
  while(d<today){
    if(recur==="monthly")d.setMonth(d.getMonth()+1);
    else if(recur==="bimonthly")d.setMonth(d.getMonth()+2);
    else if(recur==="yearly")d.setFullYear(d.getFullYear()+1);
    else break;
  }
  return d;
}
function checkPaymentAlerts(){
  if(!payD.length)return;
  const urgent=[],soon=[];
  payD.forEach(p=>{
    const next=nextOccurrence(p.date,p.recur);
    const days=getDaysUntil(next.toISOString().split("T")[0]);
    if(days<=0)urgent.push({...p,days,nextDate:next});
    else if(days<=7)soon.push({...p,days,nextDate:next});
  });
  const tabP=document.getElementById("tab-pagos");
  let dot=tabP.querySelector(".tab-dot");
  if(urgent.length||soon.length){if(!dot){dot=document.createElement("span");dot.className="tab-dot";tabP.appendChild(dot);}}
  else if(dot)dot.remove();
  if(urgent.length){
    const items=urgent.map(p=>`
      <div class="modal-item danger">
        <div><div class="mi-name">${p.name}</div><div class="mi-meta">${p.days===0?"Vence hoy":"Venció hace "+Math.abs(p.days)+" día"+(Math.abs(p.days)>1?"s":"")}</div></div>
        <div style="text-align:right">${p.amount?`<div class="mi-amt" style="color:var(--red)">${p.currency||"$"}${p.amount}</div>`:""}
          <span class="mi-tag danger">${p.days===0?"Hoy":"Vencido"}</span></div>
      </div>`).join("");
    document.getElementById("modal-title").textContent="Pago pendiente";
    document.getElementById("modal-sub").textContent="Tenés "+urgent.length+" pago"+(urgent.length>1?"s pendientes":" que vence hoy")+".";
    document.getElementById("modal-list").innerHTML=items;
    document.getElementById("pay-modal").classList.add("open");
    showBanner("danger","",urgent.length+" pago"+(urgent.length>1?"s":"")+" pendiente",urgent.map(p=>p.name).join(", "));
  } else if(soon.length){
    showBanner("warn","","Próximo pago en "+soon[0].days+" día"+(soon[0].days>1?"s":""),soon.map(p=>`${p.name}${p.amount?" · "+(p.currency||"$")+p.amount:""}`).join(" · "));
  }
}
function showBanner(type,icon,title,body){
  const el=document.getElementById("g-alert");
  el.className=type; el.style.display="flex";
  document.getElementById("ga-icon").textContent=icon;
  document.getElementById("ga-title").textContent=title;
  document.getElementById("ga-body").textContent=body;
  document.getElementById("wrap").style.paddingTop=el.offsetHeight+"px";
}
function closeAlert(){document.getElementById("g-alert").style.display="none";document.getElementById("wrap").style.paddingTop="0";}
function closeModal(){document.getElementById("pay-modal").classList.remove("open");}

function selRecur(val,btn){
  selRecurVal=val;
  document.querySelectorAll(".rcbtn").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
}
function addPayment(){
  const name=document.getElementById("pay-name").value.trim();
  const amount=parseFloat(document.getElementById("pay-amount").value)||0;
  const currency=document.getElementById("pay-currency").value.trim()||"$";
  const date=document.getElementById("pay-date").value;
  const notes=document.getElementById("pay-notes").value.trim();
  if(!name||!date){alert("Completá el nombre y la fecha.");return;}
  payD.push({id:Date.now(),name,amount,currency,date,recur:selRecurVal,notes});
  sv(K.pay,payD);
  document.getElementById("pay-name").value="";document.getElementById("pay-amount").value="";document.getElementById("pay-notes").value="";
  selRecurVal="none";document.querySelectorAll(".rcbtn").forEach((b,i)=>b.classList.toggle("active",i===0));
  renderPayments();checkPaymentAlerts();
}
function deletePayment(id){payD=payD.filter(p=>p.id!==id);sv(K.pay,payD);renderPayments();checkPaymentAlerts();}
function markPaid(id){
  const p=payD.find(x=>x.id===id);if(!p)return;
  if(p.recur==="none"){deletePayment(id);return;}
  const next=nextOccurrence(p.date,p.recur);
  if(p.recur==="monthly")next.setMonth(next.getMonth()+1);
  else if(p.recur==="bimonthly")next.setMonth(next.getMonth()+2);
  else if(p.recur==="yearly")next.setFullYear(next.getFullYear()+1);
  p.date=next.toISOString().split("T")[0];
  sv(K.pay,payD);renderPayments();checkPaymentAlerts();
}
function renderPayments(){
  const list=document.getElementById("pay-list");
  if(!payD.length){list.innerHTML='<div class="empty">Sin pagos registrados</div>';return;}
  const sorted=[...payD].map(p=>({...p,nextDate:nextOccurrence(p.date,p.recur)})).sort((a,b)=>a.nextDate-b.nextDate);
  list.innerHTML=sorted.map(p=>{
    const days=getDaysUntil(p.nextDate.toISOString().split("T")[0]);
    const[y,m,d]=p.nextDate.toISOString().split("T")[0].split("-");
    let cls="",tc="ok",bt="";
    if(days<0){cls="urgent";tc="danger";bt="Venció hace "+Math.abs(days)+"d";}
    else if(days===0){cls="urgent";tc="danger";bt="Hoy";}
    else if(days<=7){cls="soon";tc="warn";bt="En "+days+" día"+(days>1?"s":"");}
    else{tc="ok";bt="En "+days+" días";}
    return `<div class="pay-item ${cls}">
      <div class="p-l"><div class="p-name">${p.name}</div><div class="p-meta">${d}/${m}/${y} · ${RECUR_LBL[p.recur]||p.recur}${p.notes?" · "+p.notes:""}</div></div>
      <div class="p-r">
        ${p.amount?`<span class="p-amt">${p.currency}${p.amount}</span>`:""}
        <span class="p-tag ${tc}">${bt}</span>
        <div class="p-acts"><button class="btn-paid" onclick="markPaid(${p.id})">✓ Pagado</button><button class="btn-del" onclick="deletePayment(${p.id})">✕</button></div>
      </div></div>`;
  }).join("");
}

function todayDayIdx(){const d=new Date().getDay();return d===0?6:d-1;}
function renderRutina(){
  const ti=todayDayIdx();
  document.getElementById("today-day-name").textContent=DAY_NAMES[ti].toUpperCase();
  const exs=rutD[ti]||[];
  document.getElementById("today-exercises").innerHTML=exs.length===0
    ?'<div style="font-size:13px;color:var(--text3)">Sin ejercicios para hoy. Configurá tu rutina abajo.</div>'
    :`<div class="ex-list">${exs.map((e,i)=>`<div class="ex-chip"><span class="ex-n">${String(i+1).padStart(2,'0')}</span>${e}</div>`).join("")}</div>`;
  document.getElementById("day-tabs").innerHTML=DAY_NAMES.map((n,i)=>`<button class="dtab${i===editingDay?" active":""}" onclick="selectEditDay(${i})">${n.slice(0,3)}</button>`).join("");
  renderDayEditor();renderFullWeek();
}
function selectEditDay(i){editingDay=i;renderRutina();}
function renderDayEditor(){
  document.getElementById("editing-day-label").textContent=DAY_NAMES[editingDay];
  const exs=rutD[editingDay]||[];
  document.getElementById("exercise-editor").innerHTML=exs.length===0
    ?'<div class="empty" style="padding:12px;font-size:12px">Sin ejercicios aún</div>'
    :exs.map((e,i)=>`<div class="ex-row"><span style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--accent);min-width:22px;font-weight:700">${String(i+1).padStart(2,'0')}</span><input class="inp" value="${e.replace(/"/g,'&quot;')}" onchange="updateExercise(${i},this.value)" style="flex:1"/><button class="btn-del" onclick="removeExercise(${i})">✕</button></div>`).join("");
}
function addExercise(){
  const inp=document.getElementById("new-ex-input");const val=inp.value.trim();if(!val)return;
  if(!rutD[editingDay])rutD[editingDay]=[];rutD[editingDay].push(val);sv(K.rut,rutD);inp.value="";renderRutina();
}
function updateExercise(idx,val){if(rutD[editingDay])rutD[editingDay][idx]=val;sv(K.rut,rutD);}
function removeExercise(idx){if(rutD[editingDay])rutD[editingDay].splice(idx,1);sv(K.rut,rutD);renderRutina();}
function renderFullWeek(){
  document.getElementById("full-week").innerHTML=DAY_NAMES.map((n,i)=>{
    const exs=rutD[i]||[],isToday=i===todayDayIdx();
    return `<div style="padding:14px 18px;border-radius:12px;background:var(--surface2);border:1px solid ${isToday?"rgba(255,30,0,.3)":"var(--border)"};transition:all .15s">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:${exs.length?6:0}px">
        <span style="font-family:'Bebas Neue',sans-serif;font-size:17px;letter-spacing:.04em;color:${isToday?"var(--text)":"var(--text2)"}">${n.toUpperCase()}</span>
        ${isToday?`<span style="font-size:9px;font-weight:700;background:var(--accent);color:#fff;padding:2px 10px;border-radius:40px;letter-spacing:.08em">HOY</span>`:""}
        <span style="margin-left:auto;font-size:11px;color:var(--text3);font-weight:600">${exs.length?exs.length+" ejercicio"+(exs.length>1?"s":""):"Descanso"}</span>
      </div>
      ${exs.length?`<div style="display:flex;flex-direction:column;gap:2px">${exs.map(e=>`<div style="font-size:12px;color:var(--text2)">— ${e}</div>`).join("")}</div>`:""}
    </div>`;
  }).join("");
}

function addWeight(){
  const date=document.getElementById("w-date").value;
  const kg=parseFloat(document.getElementById("w-kg").value);
  const note=document.getElementById("w-note").value.trim();
  if(!date||isNaN(kg)){alert("Completá la fecha y el peso.");return;}
  wD=wD.filter(e=>e.date!==date);wD.push({date,kg,note});
  wD.sort((a,b)=>a.date.localeCompare(b.date));
  sv(K.w,wD);document.getElementById("w-kg").value="";document.getElementById("w-note").value="";renderW();
}
function delWeight(date){wD=wD.filter(e=>e.date!==date);sv(K.w,wD);renderW();}
function renderW(){
  const list=document.getElementById("w-list");list.innerHTML="";
  if(!wD.length){list.innerHTML='<div class="empty">Sin registros aún</div>';}
  else{[...wD].reverse().forEach(e=>{
    const[y,m,d]=e.date.split("-");
    const item=document.createElement("div");item.className="log-row";
    item.innerHTML=`<div class="lr-l"><span class="lr-val">${e.kg} kg</span>${e.note?`<span class="lr-note">${e.note}</span>`:""}<span class="lr-date">${d}/${m}/${y}</span></div><button class="btn-del" onclick="delWeight('${e.date}')">✕</button>`;
    list.appendChild(item);
  });}
  if(wD.length){
    const kgs=wD.map(e=>e.kg),cur=wD[wD.length-1].kg;
    document.getElementById("w-cur").textContent=cur;
    document.getElementById("w-min").textContent=Math.min(...kgs);
    document.getElementById("w-max").textContent=Math.max(...kgs);
    if(wD.length>=2){
      const diff=(cur-wD[0].kg).toFixed(1);
      const c=diff<0?"var(--green)":diff>0?"var(--red)":"var(--amber)";
      document.getElementById("w-change").innerHTML=`Cambio total <span style="color:${c}">${diff>0?"+":""}${diff} kg</span>`;
    } else document.getElementById("w-change").textContent="";
  } else {
    ["w-cur","w-min","w-max"].forEach(id=>document.getElementById(id).textContent="—");
    document.getElementById("w-change").textContent="";
  }
  renderWChart();
}
function renderWChart(){
  const dark=document.documentElement.getAttribute("data-theme")==="dark";
  const gc=dark?"rgba(255,255,255,.04)":"rgba(0,0,0,.04)";
  const tc=dark?"#3a3a3a":"#c0c0bc";
  if(wChart){wChart.destroy();wChart=null;}
  const ctx=document.getElementById("wChart");if(!ctx)return;
  wChart=new Chart(ctx,{
    type:"line",
    data:{
      labels:wD.map(e=>{const[y,m,d]=e.date.split("-");return`${d}/${m}`;}),
      datasets:[{
        data:wD.map(e=>e.kg),
        borderColor:"#ff1e00",
        backgroundColor:"rgba(255,30,0,.06)",
        borderWidth:2,
        pointBackgroundColor:"#ff1e00",
        pointRadius:3,pointBorderColor:"transparent",
        tension:0.4,fill:true
      }]
    },
    options:{
      responsive:true,maintainAspectRatio:false,
      plugins:{legend:{display:false}},
      scales:{
        x:{ticks:{color:tc,font:{size:10,family:"JetBrains Mono"}},grid:{color:gc}},
        y:{ticks:{color:tc,font:{size:10,family:"JetBrains Mono"}},grid:{color:gc}}
      }
    }
  });
}

function selDS(s){
  dStatus=s;
  document.getElementById("dsb-green").className="dst-btn"+(s==="green"?" sg":"");
  document.getElementById("dsb-yellow").className="dst-btn"+(s==="yellow"?" sa":"");
  document.getElementById("dsb-red").className="dst-btn"+(s==="red"?" sr":"");
}
function chDietY(d){dYear+=d;renderDStats();document.getElementById("d-year").textContent=dYear;}
function chDietM(d){dMonth+=d;if(dMonth<0){dMonth=11;dYear--;}if(dMonth>11){dMonth=0;dYear++;}renderDCal();}
function addDiet(){
  const date=document.getElementById("d-date").value;
  const food=document.getElementById("d-food").value.trim();
  const notes=document.getElementById("d-notes").value.trim();
  if(!date){alert("Seleccioná una fecha.");return;}
  if(!dStatus){alert("Seleccioná si seguiste la dieta.");return;}
  dD[date]={status:dStatus,food,notes};sv(K.d,dD);
  document.getElementById("d-food").value="";document.getElementById("d-notes").value="";
  dStatus=null;
  ["dsb-green","dsb-yellow","dsb-red"].forEach(id=>document.getElementById(id).className="dst-btn");
  renderD();
}
function delDiet(date){delete dD[date];sv(K.d,dD);renderD();}
function renderD(){document.getElementById("d-year").textContent=dYear;renderDStats();renderDCal();renderDList();}
function renderDStats(){
  let g=0,y=0,r=0;
  for(const[k,v]of Object.entries(dD)){if(!k.startsWith(dYear+"-"))continue;if(v.status==="green")g++;else if(v.status==="yellow")y++;else if(v.status==="red")r++;}
  document.getElementById("ds-g").textContent=g;document.getElementById("ds-y").textContent=y;document.getElementById("ds-r").textContent=r;
}
function renderDCal(){
  document.getElementById("d-month-lbl").textContent=MONTHS[dMonth]+" "+dYear;
  const grid=document.getElementById("d-cal");grid.innerHTML="";
  const days=daysIn(dYear,dMonth),first=firstDay(dYear,dMonth);
  for(let i=0;i<first;i++){const e=document.createElement("div");e.className="ddot";e.style.opacity="0";grid.appendChild(e);}
  for(let d=1;d<=days;d++){
    const key=`${dYear}-${String(dMonth+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
    const entry=dD[key];const dot=document.createElement("div");
    dot.className="ddot"+(entry?" "+entry.status:"");
    dot.title=entry?`${d}: ${entry.status==="green"?"Completa":entry.status==="yellow"?"A medias":"No seguí"}${entry.food?"\n"+entry.food:""}`:String(d);
    grid.appendChild(dot);
  }
}
function renderDList(){
  const list=document.getElementById("d-list");list.innerHTML="";
  const entries=Object.entries(dD).sort((a,b)=>b[0].localeCompare(a[0])).slice(0,40);
  if(!entries.length){list.innerHTML='<div class="empty">Sin registros aún</div>';return;}
  entries.forEach(([date,v])=>{
    const[y,m,d]=date.split("-");
    const bl={green:"Completa",yellow:"A medias",red:"No seguí"}[v.status];
    const item=document.createElement("div");item.className="dlog";
    item.innerHTML=`<div class="dlog-head"><span class="dlog-date">${d}/${m}/${y}</span><div style="display:flex;align-items:center;gap:6px"><span class="dlog-badge ${v.status}">${bl}</span><button class="btn-del" onclick="delDiet('${date}')">✕</button></div></div>${v.food?`<div class="dlog-food">${v.food}</div>`:""}${v.notes?`<div class="dlog-notes">${v.notes}</div>`:""}`;
    list.appendChild(item);
  });
}

function changeYear(d){gYear+=d;renderGym();}
function toggleDay(m,d){
  const k=`${gYear}-${m}-${d}`;
  const cur=gymD[k]??null;
  const next=CYCLE[(CYCLE.indexOf(cur)+1)%CYCLE.length];
  if(next===null)delete gymD[k];else gymD[k]=next;
  sv(K.gym,gymD);renderGym();
}
function renderGym(){
  document.getElementById("year-display").textContent=gYear;
  const today=new Date();let g=0,y=0,r=0;
  for(const[k,v]of Object.entries(gymD)){if(!k.startsWith(gYear+"-"))continue;if(v==="green")g++;else if(v==="yellow")y++;else if(v==="red")r++;}
  document.getElementById("sg").textContent=g;document.getElementById("sy").textContent=y;document.getElementById("sr").textContent=r;
  const grid=document.getElementById("months-grid");grid.innerHTML="";
  MONTHS.forEach((mn,mi)=>{
    const days=daysIn(gYear,mi),first=firstDay(gYear,mi);
    const isCur=today.getFullYear()===gYear&&today.getMonth()===mi;
    let mg=0,my=0,mr=0;
    for(let d=1;d<=days;d++){const s=gymD[`${gYear}-${mi}-${d}`];if(s==="green")mg++;else if(s==="yellow")my++;else if(s==="red")mr++;}
    let mini="";
    if(mg>0)mini+=`<span style="color:var(--green);font-family:'JetBrains Mono',monospace">${mg}✓</span>`;
    if(my>0)mini+=`<span style="color:var(--amber);font-family:'JetBrains Mono',monospace"> ${my}~</span>`;
    if(mr>0)mini+=`<span style="color:var(--red);font-family:'JetBrains Mono',monospace"> ${mr}✕</span>`;
    const card=document.createElement("div");card.className="mc"+(isCur?" cur":"");
    card.innerHTML=`
      <div class="mc-head">
        <div><div class="mc-name${isCur?" c":""}">${mn.toUpperCase()}</div><div class="mc-mini">${mini}</div></div>
        ${isCur?'<span class="cur-tag">Hoy</span>':""}
      </div>
      <div class="dow-row">${DOW.map(d=>`<div class="dow-c">${d}</div>`).join("")}</div>
      <div class="dg" id="dg-${mi}"></div>`;
    grid.appendChild(card);
    const dg=document.getElementById(`dg-${mi}`);
    for(let i=0;i<first;i++){const e=document.createElement("div");e.className="dc empty";dg.appendChild(e);}
    for(let d=1;d<=days;d++){
      const key=`${gYear}-${mi}-${d}`,st=gymD[key]??null,isT=isCur&&today.getDate()===d;
      const cell=document.createElement("div");
      cell.className="dc"+(st?" "+st:"")+(isT?" today":"");
      cell.textContent=d;
      cell.title=st?({green:"Fui 💪",yellow:"A medias 😅",red:"No fui ❌"}[st]):"Sin marcar";
      cell.addEventListener("click",()=>toggleDay(mi,d));
      dg.appendChild(cell);
    }
  });
}

const todayStr=new Date().toISOString().split("T")[0];
load();
document.getElementById("w-date").value=todayStr;
document.getElementById("d-date").value=todayStr;
document.getElementById("pay-date").value=todayStr;
editingDay=todayDayIdx();
renderGym();
setTimeout(checkPaymentAlerts,300);
</script>
</body>
</html>
