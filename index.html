<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Gym Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet"/>
<style>
* { box-sizing:border-box; margin:0; padding:0; }

:root[data-theme="dark"] {
  --bg:#0a0a0f; --bg2:#13131e; --bg3:#1e1e2e;
  --border:#1e1e2e; --border2:#2e2e4e;
  --text:#e8e8f0; --text2:#888; --text3:#444;
  --accent:#a0a0ff; --accent-bg:#a0a0ff22;
  --cell-bg:#13131e; --cell-bdr:#2a2a3a;
  --input-bg:#1e1e2e; --shadow:rgba(0,0,0,0.5);
  --warn:#f59e0b; --warn-bg:#f59e0b18;
  --danger:#ef4444; --danger-bg:#ef444422;
  --ok:#22c55e; --ok-bg:#22c55e18;
}
:root[data-theme="light"] {
  --bg:#f0f0f7; --bg2:#ffffff; --bg3:#e8e8f2;
  --border:#ddddf0; --border2:#c0c0e0;
  --text:#1a1a2e; --text2:#666; --text3:#bbb;
  --accent:#5a5aff; --accent-bg:#5a5aff18;
  --cell-bg:#f8f8ff; --cell-bdr:#ddddf0;
  --input-bg:#f0f0fa; --shadow:rgba(0,0,0,0.1);
  --warn:#d97706; --warn-bg:#fef3c7;
  --danger:#dc2626; --danger-bg:#fee2e2;
  --ok:#16a34a; --ok-bg:#dcfce7;
}

body { min-height:100vh; background:var(--bg); color:var(--text); font-family:'DM Mono','Courier New',monospace; transition:background .3s,color .3s; }
.app-container { max-width:980px; margin:0 auto; padding:28px 16px; }

/* ‚îÄ‚îÄ GLOBAL PAYMENT ALERT BANNER ‚îÄ‚îÄ */
#global-alert {
  display:none;
  position:fixed; top:0; left:0; right:0; z-index:1000;
  padding:14px 20px;
  display:flex; align-items:center; justify-content:space-between; gap:12px;
  font-size:13px; flex-wrap:wrap;
  box-shadow:0 4px 20px rgba(0,0,0,0.4);
  animation: slideDown .4s ease;
}
#global-alert.danger { background:#ef4444; color:#fff; }
#global-alert.warn   { background:#f59e0b; color:#fff; }
#global-alert.hidden { display:none !important; }
@keyframes slideDown { from{transform:translateY(-100%)} to{transform:translateY(0)} }
.alert-left { display:flex; align-items:center; gap:10px; }
.alert-icon { font-size:22px; }
.alert-text strong { display:block; font-size:14px; }
.alert-actions { display:flex; gap:8px; align-items:center; }
.alert-btn {
  background:rgba(255,255,255,0.25); border:1px solid rgba(255,255,255,0.4);
  color:#fff; border-radius:8px; padding:5px 14px; font-family:inherit;
  font-size:12px; cursor:pointer; transition:background .2s; white-space:nowrap;
}
.alert-btn:hover { background:rgba(255,255,255,0.35); }
.alert-close {
  background:none; border:none; color:rgba(255,255,255,0.8);
  font-size:20px; cursor:pointer; padding:0 4px; line-height:1;
}
#app-content { transition: margin-top .4s; }

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.modal-overlay {
  display:none; position:fixed; inset:0; z-index:2000;
  background:rgba(0,0,0,0.7); align-items:center; justify-content:center;
  padding:16px;
}
.modal-overlay.open { display:flex; }
.modal {
  background:var(--bg2); border-radius:20px; padding:28px;
  max-width:460px; width:100%;
  box-shadow:0 20px 60px rgba(0,0,0,0.5);
  animation: popIn .3s ease;
  border:1px solid var(--border2);
}
@keyframes popIn { from{transform:scale(.9);opacity:0} to{transform:scale(1);opacity:1} }
.modal-icon { font-size:48px; text-align:center; margin-bottom:12px; }
.modal-title { font-family:'Bebas Neue',sans-serif; font-size:28px; letter-spacing:2px; text-align:center; margin-bottom:6px; }
.modal-subtitle { color:var(--text2); font-size:13px; text-align:center; margin-bottom:20px; }
.modal-pay-list { display:flex; flex-direction:column; gap:8px; margin-bottom:20px; }
.modal-pay-item {
  border-radius:10px; padding:12px 14px;
  display:flex; justify-content:space-between; align-items:center;
}
.modal-pay-item.danger { background:var(--danger-bg); border:1px solid var(--danger); }
.modal-pay-item.warn   { background:var(--warn-bg);   border:1px solid var(--warn); }
.modal-pay-name { font-size:13px; font-weight:500; }
.modal-pay-meta { font-size:11px; color:var(--text2); margin-top:2px; }
.modal-pay-right { text-align:right; }
.modal-pay-amount { font-family:'Bebas Neue',sans-serif; font-size:20px; }
.modal-pay-badge { font-size:10px; padding:2px 8px; border-radius:20px; }
.modal-pay-badge.danger { background:var(--danger-bg); color:var(--danger); border:1px solid var(--danger); }
.modal-pay-badge.warn   { background:var(--warn-bg);   color:var(--warn);   border:1px solid var(--warn); }
.modal-footer { display:flex; gap:8px; justify-content:center; flex-wrap:wrap; }
.modal-btn {
  border:none; border-radius:10px; padding:10px 24px;
  font-family:inherit; font-size:13px; cursor:pointer; transition:opacity .2s;
}
.modal-btn.primary { background:var(--accent); color:#fff; }
.modal-btn.secondary { background:var(--bg3); color:var(--text2); border:1px solid var(--border2); }
.modal-btn:hover { opacity:.85; }

/* ‚îÄ‚îÄ TOP BAR ‚îÄ‚îÄ */
.top-bar { display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:12px; margin-bottom:20px; }
h1 { font-family:'Bebas Neue',sans-serif; font-size:clamp(36px,7vw,66px); letter-spacing:4px; line-height:1; }
.theme-toggle { background:var(--bg3); border:1px solid var(--border2); border-radius:50px; padding:4px; display:flex; cursor:pointer; gap:2px; }
.theme-toggle span { padding:4px 12px; border-radius:50px; font-size:13px; transition:background .2s,color .2s; color:var(--text2); }
.theme-toggle span.active { background:var(--accent); color:#fff; }

.nav-tabs { display:flex; gap:4px; background:var(--bg3); border-radius:12px; padding:4px; margin-bottom:24px; flex-wrap:wrap; }
.tab-btn { padding:8px 16px; border-radius:9px; border:none; background:transparent; color:var(--text2); font-family:inherit; font-size:13px; cursor:pointer; transition:background .2s,color .2s; white-space:nowrap; position:relative; }
.tab-btn.active { background:var(--accent); color:#fff; }
.tab-btn:hover:not(.active) { background:var(--border2); color:var(--text); }
.tab-badge { position:absolute; top:4px; right:6px; width:8px; height:8px; border-radius:50%; background:#ef4444; }

.section { display:none; }
.section.active { display:block; }

.year-nav { display:flex; align-items:center; gap:8px; }
.year-btn { background:var(--bg3); border:1px solid var(--border2); color:var(--text); padding:6px 14px; border-radius:8px; cursor:pointer; font-family:inherit; font-size:14px; transition:background .2s; }
.year-btn:hover { background:var(--border2); }

.legend { display:flex; gap:16px; flex-wrap:wrap; align-items:center; margin-bottom:20px; font-size:13px; }
.legend-item { display:flex; align-items:center; gap:6px; color:var(--text2); }
.legend-dot { width:12px; height:12px; border-radius:3px; }
.legend-hint { color:var(--text3); font-size:12px; margin-left:auto; }

.stats-bar { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:28px; }
.stat-card { background:var(--bg2); border-radius:12px; padding:12px 18px; display:flex; flex-direction:column; align-items:center; min-width:76px; box-shadow:0 2px 8px var(--shadow); }
.stat-num { font-family:'Bebas Neue',sans-serif; font-size:30px; line-height:1; }
.stat-lbl { font-size:10px; color:var(--text2); margin-top:2px; }

#months-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(278px,1fr)); gap:14px; }
.month-card { background:var(--bg2); border:1px solid var(--border); border-radius:14px; padding:18px; transition:border-color .2s; box-shadow:0 2px 8px var(--shadow); }
.month-card:hover { border-color:var(--border2); }
.month-card.current { border-color:var(--accent); }
.month-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:10px; }
.month-name { font-family:'Bebas Neue',sans-serif; font-size:21px; letter-spacing:2px; }
.month-name.current-name { color:var(--accent); }
.month-mini-stats { display:flex; gap:8px; margin-top:2px; font-size:11px; }
.current-badge { font-size:10px; color:var(--accent); background:var(--accent-bg); padding:2px 8px; border-radius:20px; }
.dow-header { display:grid; grid-template-columns:repeat(7,32px); gap:3px; margin-bottom:4px; }
.dow-cell { width:32px; text-align:center; font-size:10px; color:var(--text3); }
.days-grid { display:grid; grid-template-columns:repeat(7,32px); gap:3px; }
.day-cell { width:32px; height:32px; border-radius:6px; border:1px solid var(--cell-bdr); background:var(--cell-bg); cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:11px; color:var(--text3); transition:transform .1s,border-color .2s; user-select:none; }
.day-cell:hover { transform:scale(1.14); border-color:var(--text2); }
.day-cell.empty { opacity:0; pointer-events:none; }
.day-cell.green  { background:#22c55e22; border-color:#22c55e; color:#22c55e; }
.day-cell.yellow { background:#eab30822; border-color:#eab308; color:#eab308; }
.day-cell.red    { background:#ef444422; border-color:#ef4444; color:#ef4444; }
.day-cell.today  { outline:2px solid var(--accent); outline-offset:1px; }

.two-col { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
@media(max-width:640px){ .two-col { grid-template-columns:1fr; } }

.card { background:var(--bg2); border:1px solid var(--border); border-radius:14px; padding:20px; box-shadow:0 2px 8px var(--shadow); margin-bottom:16px; }
.card h2 { font-family:'Bebas Neue',sans-serif; font-size:20px; letter-spacing:2px; margin-bottom:14px; color:var(--accent); }
.form-row { display:flex; gap:8px; margin-bottom:10px; flex-wrap:wrap; }
.form-input { flex:1; min-width:100px; background:var(--input-bg); border:1px solid var(--border2); border-radius:8px; color:var(--text); font-family:inherit; font-size:13px; padding:8px 12px; outline:none; transition:border-color .2s; }
.form-input:focus { border-color:var(--accent); }
textarea.form-input { resize:vertical; min-height:54px; }
.btn-add { background:var(--accent); border:none; border-radius:8px; color:#fff; font-family:inherit; font-size:13px; padding:8px 16px; cursor:pointer; transition:opacity .2s; white-space:nowrap; }
.btn-add:hover { opacity:.85; }
.btn-del { background:none; border:none; color:var(--text3); cursor:pointer; font-size:16px; padding:0 4px; transition:color .2s; }
.btn-del:hover { color:#ef4444; }

.log-list { display:flex; flex-direction:column; gap:6px; max-height:300px; overflow-y:auto; }
.log-item { display:flex; justify-content:space-between; align-items:center; background:var(--bg3); border-radius:8px; padding:8px 12px; font-size:13px; }
.log-item-left { display:flex; flex-direction:column; }
.log-date { color:var(--text2); font-size:11px; }
.log-val { font-weight:500; }
.log-note { color:var(--text2); font-size:11px; margin-top:2px; }

.weight-summary { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-bottom:12px; }
.weight-stat { background:var(--bg3); border-radius:10px; padding:10px; text-align:center; }
.ws-num { font-family:'Bebas Neue',sans-serif; font-size:24px; color:var(--accent); }
.ws-lbl { font-size:10px; color:var(--text2); }
.chart-wrap { width:100%; height:130px; position:relative; }

.diet-status-row { display:flex; gap:8px; margin-bottom:10px; flex-wrap:wrap; }
.diet-status-btn { flex:1; padding:8px; border-radius:8px; border:1px solid var(--border2); background:var(--bg3); color:var(--text2); font-family:inherit; font-size:12px; cursor:pointer; transition:all .2s; text-align:center; }
.diet-status-btn.sel-green  { background:#22c55e22; border-color:#22c55e; color:#22c55e; }
.diet-status-btn.sel-yellow { background:#eab30822; border-color:#eab308; color:#eab308; }
.diet-status-btn.sel-red    { background:#ef444422; border-color:#ef4444; color:#ef4444; }
.diet-cal-header { display:grid; grid-template-columns:repeat(7,1fr); gap:4px; margin-bottom:4px; }
.diet-cal-dow { text-align:center; font-size:10px; color:var(--text3); }
.diet-cal-grid { display:grid; grid-template-columns:repeat(7,1fr); gap:4px; }
.diet-dot { aspect-ratio:1; border-radius:4px; background:var(--bg3); border:1px solid var(--border); }
.diet-dot.green  { background:#22c55e44; border-color:#22c55e; }
.diet-dot.yellow { background:#eab30844; border-color:#eab308; }
.diet-dot.red    { background:#ef444444; border-color:#ef4444; }
.diet-log-item { background:var(--bg3); border-radius:10px; padding:10px 14px; font-size:13px; margin-bottom:6px; }
.diet-log-header { display:flex; justify-content:space-between; align-items:center; }
.diet-log-date { font-size:11px; color:var(--text2); }
.diet-badge { font-size:10px; padding:2px 8px; border-radius:20px; }
.diet-badge.green  { background:#22c55e22; color:#22c55e; }
.diet-badge.yellow { background:#eab30822; color:#eab308; }
.diet-badge.red    { background:#ef444422; color:#ef4444; }
.diet-log-food  { color:var(--text2); font-size:11px; margin-top:4px; }
.diet-log-notes { color:var(--text3); font-size:11px; margin-top:2px; font-style:italic; }

.section-header { display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:8px; margin-bottom:20px; }
.section-header h2 { font-family:'Bebas Neue',sans-serif; font-size:28px; letter-spacing:3px; }

/* ‚îÄ‚îÄ PAYMENTS ‚îÄ‚îÄ */
.pay-item {
  background:var(--bg2); border:1px solid var(--border);
  border-radius:12px; padding:14px 16px; margin-bottom:10px;
  box-shadow:0 2px 8px var(--shadow);
  display:flex; align-items:center; gap:12px;
  transition:border-color .2s;
}
.pay-item.urgent { border-color:var(--danger); }
.pay-item.soon   { border-color:var(--warn); }
.pay-left { flex:1; }
.pay-name { font-size:14px; font-weight:500; }
.pay-meta { font-size:11px; color:var(--text2); margin-top:3px; }
.pay-right { display:flex; flex-direction:column; align-items:flex-end; gap:6px; }
.pay-amount { font-family:'Bebas Neue',sans-serif; font-size:22px; color:var(--accent); }
.pay-badge { font-size:10px; padding:3px 10px; border-radius:20px; white-space:nowrap; }
.pay-badge.danger { background:var(--danger-bg); color:var(--danger); border:1px solid var(--danger); }
.pay-badge.warn   { background:var(--warn-bg);   color:var(--warn);   border:1px solid var(--warn); }
.pay-badge.ok     { background:var(--ok-bg);     color:var(--ok);     border:1px solid var(--ok); }
.pay-actions { display:flex; gap:4px; align-items:center; }
.btn-paid { background:var(--ok-bg); border:1px solid var(--ok); color:var(--ok); border-radius:8px; padding:4px 12px; font-family:inherit; font-size:11px; cursor:pointer; transition:opacity .2s; white-space:nowrap; }
.btn-paid:hover { opacity:.75; }

.recur-options { display:flex; gap:6px; flex-wrap:wrap; margin-bottom:10px; }
.recur-btn { padding:6px 14px; border-radius:8px; border:1px solid var(--border2); background:var(--bg3); color:var(--text2); font-family:inherit; font-size:12px; cursor:pointer; transition:all .2s; }
.recur-btn.active { background:var(--accent); border-color:var(--accent); color:#fff; }

/* ‚îÄ‚îÄ RUTINA ‚îÄ‚îÄ */
.today-routine { background:var(--bg2); border:2px solid var(--accent); border-radius:16px; padding:20px; margin-bottom:20px; box-shadow:0 4px 16px var(--accent-bg); }
.today-routine h3 { font-family:'Bebas Neue',sans-serif; font-size:13px; letter-spacing:2px; color:var(--accent); margin-bottom:4px; }
.today-routine .routine-day-name { font-family:'Bebas Neue',sans-serif; font-size:28px; letter-spacing:3px; margin-bottom:8px; }
.exercise-list { display:flex; flex-direction:column; gap:6px; }
.exercise-chip { background:var(--bg3); border-radius:8px; padding:8px 12px; font-size:13px; display:flex; align-items:center; gap:8px; }
.ex-num { color:var(--accent); font-size:11px; min-width:18px; }
.day-tabs { display:flex; gap:4px; flex-wrap:wrap; margin-bottom:16px; }
.day-tab { padding:6px 14px; border-radius:8px; border:1px solid var(--border2); background:var(--bg3); color:var(--text2); font-family:inherit; font-size:12px; cursor:pointer; transition:all .2s; }
.day-tab.active { background:var(--accent); border-color:var(--accent); color:#fff; }
.exercise-editor { display:flex; flex-direction:column; gap:6px; margin-bottom:10px; max-height:240px; overflow-y:auto; }
.ex-row { display:flex; gap:6px; align-items:center; }

.footer { text-align:center; margin-top:36px; color:var(--text3); font-size:12px; }
::-webkit-scrollbar { width:6px; }
::-webkit-scrollbar-thumb { background:var(--border2); border-radius:3px; }
</style>
</head>
<body>

<!-- ‚îÄ‚îÄ GLOBAL ALERT BANNER ‚îÄ‚îÄ -->
<div id="global-alert" class="hidden">
  <div class="alert-left">
    <span class="alert-icon" id="alert-icon"></span>
    <div class="alert-text">
      <strong id="alert-title"></strong>
      <span id="alert-body"></span>
    </div>
  </div>
  <div class="alert-actions">
    <button class="alert-btn" onclick="showTab('pagos');closeAlert()">Ver pagos</button>
    <button class="alert-close" onclick="closeAlert()">‚úï</button>
  </div>
</div>

<!-- ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ -->
<div class="modal-overlay" id="pay-modal">
  <div class="modal">
    <div class="modal-icon" id="modal-icon"></div>
    <div class="modal-title" id="modal-title"></div>
    <div class="modal-subtitle" id="modal-subtitle"></div>
    <div class="modal-pay-list" id="modal-pay-list"></div>
    <div class="modal-footer">
      <button class="modal-btn primary" onclick="showTab('pagos');closeModal()">Ver todos los pagos</button>
      <button class="modal-btn secondary" onclick="closeModal()">Cerrar</button>
    </div>
  </div>
</div>

<div class="app-container" id="app-content">
  <div class="top-bar">
    <h1>GYM TRACKER</h1>
    <div class="theme-toggle" onclick="toggleTheme()">
      <span id="th-dark" class="active">üåô Oscuro</span>
      <span id="th-light">‚òÄÔ∏è Claro</span>
    </div>
  </div>

  <div class="nav-tabs">
    <button class="tab-btn active" onclick="showTab('gym')">üèãÔ∏è Gym</button>
    <button class="tab-btn" onclick="showTab('rutina')">üìã Rutina</button>
    <button class="tab-btn" id="tab-pagos" onclick="showTab('pagos')">üí≥ Pagos</button>
    <button class="tab-btn" onclick="showTab('peso')">‚öñÔ∏è Peso</button>
    <button class="tab-btn" onclick="showTab('dieta')">ü•ó Dieta</button>
  </div>

  <!-- ‚ïê‚ïê GYM ‚ïê‚ïê -->
  <div id="sec-gym" class="section active">
    <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;margin-bottom:10px">
      <div class="legend">
        <div class="legend-item"><div class="legend-dot" style="background:#22c55e"></div>Fui üí™</div>
        <div class="legend-item"><div class="legend-dot" style="background:#eab308"></div>A medias üòÖ</div>
        <div class="legend-item"><div class="legend-dot" style="background:#ef4444"></div>No fui ‚ùå</div>
        <span class="legend-hint">Click para cambiar</span>
      </div>
      <div class="year-nav">
        <button class="year-btn" onclick="changeYear(-1)">‚óÄ</button>
        <span id="year-display" style="font-size:20px;min-width:50px;text-align:center"></span>
        <button class="year-btn" onclick="changeYear(1)">‚ñ∂</button>
      </div>
    </div>
    <div class="stats-bar">
      <div class="stat-card" style="border:1px solid #22c55e33"><span class="stat-num" id="sg" style="color:#22c55e">0</span><span class="stat-lbl">D√≠as fui</span></div>
      <div class="stat-card" style="border:1px solid #eab30833"><span class="stat-num" id="sy" style="color:#eab308">0</span><span class="stat-lbl">A medias</span></div>
      <div class="stat-card" style="border:1px solid #ef444433"><span class="stat-num" id="sr" style="color:#ef4444">0</span><span class="stat-lbl">No fui</span></div>
    </div>
    <div id="months-grid"></div>
  </div>

  <!-- ‚ïê‚ïê RUTINA ‚ïê‚ïê -->
  <div id="sec-rutina" class="section">
    <div class="section-header"><h2>üìã Mi Rutina Semanal</h2></div>
    <div class="today-routine">
      <h3>HOY ES</h3>
      <div class="routine-day-name" id="today-day-name"></div>
      <div id="today-exercises"></div>
    </div>
    <div class="card">
      <h2>Editar rutina</h2>
      <div class="day-tabs" id="day-tabs"></div>
      <div style="font-size:12px;color:var(--text2);margin-bottom:8px" id="editing-day-label"></div>
      <div class="exercise-editor" id="exercise-editor"></div>
      <div class="form-row">
        <input type="text" id="new-ex-input" class="form-input" placeholder="Ej: Press banca 4x10, Sentadilla 3x12..."/>
        <button class="btn-add" onclick="addExercise()">+ Agregar</button>
      </div>
    </div>
    <div class="card">
      <h2>Semana completa</h2>
      <div id="full-week" style="display:flex;flex-direction:column;gap:10px"></div>
    </div>
  </div>

  <!-- ‚ïê‚ïê PAGOS ‚ïê‚ïê -->
  <div id="sec-pagos" class="section">
    <div class="section-header"><h2>üí≥ Pagos del Gym</h2></div>
    <div class="two-col">
      <!-- FORM -->
      <div>
        <div class="card">
          <h2>Nuevo pago</h2>
          <div class="form-row">
            <input type="text" id="pay-name" class="form-input" placeholder="Nombre (ej: Cuota gym)"/>
          </div>
          <div class="form-row">
            <input type="number" id="pay-amount" class="form-input" placeholder="Monto" min="0" step="0.01"/>
            <input type="text"   id="pay-currency" class="form-input" placeholder="$" value="$" style="max-width:64px"/>
          </div>
          <div class="form-row">
            <input type="date" id="pay-date" class="form-input"/>
          </div>
          <div style="font-size:12px;color:var(--text2);margin-bottom:8px">¬øSe repite?</div>
          <div class="recur-options" id="recur-options">
            <button class="recur-btn active" onclick="selRecur('none',this)">Una vez</button>
            <button class="recur-btn" onclick="selRecur('monthly',this)">Mensual</button>
            <button class="recur-btn" onclick="selRecur('bimonthly',this)">Cada 2 meses</button>
            <button class="recur-btn" onclick="selRecur('yearly',this)">Anual</button>
          </div>
          <div class="form-row">
            <textarea id="pay-notes" class="form-input" placeholder="Notas (opcional)"></textarea>
          </div>
          <button class="btn-add" style="width:100%" onclick="addPayment()">+ Agregar pago</button>
        </div>
      </div>
      <!-- LIST -->
      <div>
        <div class="card">
          <h2>Pr√≥ximos pagos</h2>
          <div id="pay-list"><div style="color:var(--text3);font-size:12px;text-align:center;padding:20px">Sin pagos registrados</div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê PESO ‚ïê‚ïê -->
  <div id="sec-peso" class="section">
    <div class="section-header"><h2>‚öñÔ∏è Registro de Peso</h2></div>
    <div class="two-col">
      <div>
        <div class="card">
          <h2>Agregar</h2>
          <div class="form-row">
            <input type="date" id="w-date" class="form-input"/>
            <input type="number" id="w-kg" class="form-input" placeholder="Peso (kg)" step="0.1" min="30" max="300"/>
          </div>
          <div class="form-row">
            <input type="text" id="w-note" class="form-input" placeholder="Nota (opcional)"/>
            <button class="btn-add" onclick="addWeight()">+ Agregar</button>
          </div>
        </div>
        <div class="card">
          <h2>Resumen</h2>
          <div class="weight-summary">
            <div class="weight-stat"><div class="ws-num" id="w-cur">‚Äî</div><div class="ws-lbl">Actual (kg)</div></div>
            <div class="weight-stat"><div class="ws-num" id="w-min">‚Äî</div><div class="ws-lbl">M√≠nimo</div></div>
            <div class="weight-stat"><div class="ws-num" id="w-max">‚Äî</div><div class="ws-lbl">M√°ximo</div></div>
          </div>
          <div id="w-change" style="font-size:12px;color:var(--text2);text-align:center"></div>
        </div>
      </div>
      <div>
        <div class="card"><h2>Evoluci√≥n</h2><div class="chart-wrap"><canvas id="wChart"></canvas></div></div>
        <div class="card"><h2>Historial</h2><div class="log-list" id="w-list"></div></div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê DIETA ‚ïê‚ïê -->
  <div id="sec-dieta" class="section">
    <div class="section-header">
      <h2>ü•ó Registro de Dieta</h2>
      <div class="year-nav">
        <button class="year-btn" onclick="chDietY(-1)">‚óÄ</button>
        <span id="d-year" style="font-size:18px;min-width:50px;text-align:center"></span>
        <button class="year-btn" onclick="chDietY(1)">‚ñ∂</button>
      </div>
    </div>
    <div class="two-col">
      <div>
        <div class="card">
          <h2>Registrar d√≠a</h2>
          <div class="form-row"><input type="date" id="d-date" class="form-input"/></div>
          <div style="font-size:12px;color:var(--text2);margin-bottom:8px">¬øSeguiste la dieta hoy?</div>
          <div class="diet-status-row">
            <button class="diet-status-btn" id="dsb-green"  onclick="selDS('green')" >‚úÖ S√≠, completa</button>
            <button class="diet-status-btn" id="dsb-yellow" onclick="selDS('yellow')">‚ö° A medias</button>
            <button class="diet-status-btn" id="dsb-red"    onclick="selDS('red')"   >‚ùå No segu√≠</button>
          </div>
          <div class="form-row" style="margin-top:8px">
            <textarea id="d-food" class="form-input" placeholder="¬øQu√© comiste?"></textarea>
          </div>
          <div class="form-row">
            <textarea id="d-notes" class="form-input" placeholder="Notas..." style="min-height:48px"></textarea>
            <button class="btn-add" onclick="addDiet()" style="align-self:flex-end">+ Guardar</button>
          </div>
        </div>
        <div class="card">
          <h2>Stats del a√±o</h2>
          <div class="stats-bar" style="margin-bottom:0">
            <div class="stat-card" style="border:1px solid #22c55e33;flex:1"><span class="stat-num" id="ds-g" style="color:#22c55e">0</span><span class="stat-lbl">Completa</span></div>
            <div class="stat-card" style="border:1px solid #eab30833;flex:1"><span class="stat-num" id="ds-y" style="color:#eab308">0</span><span class="stat-lbl">A medias</span></div>
            <div class="stat-card" style="border:1px solid #ef444433;flex:1"><span class="stat-num" id="ds-r" style="color:#ef4444">0</span><span class="stat-lbl">No segu√≠</span></div>
          </div>
        </div>
      </div>
      <div>
        <div class="card">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px">
            <button class="year-btn" style="padding:4px 10px;font-size:12px" onclick="chDietM(-1)">‚óÄ</button>
            <span id="d-month-lbl" style="font-size:13px;flex:1;text-align:center;font-family:'Bebas Neue',sans-serif;letter-spacing:1px"></span>
            <button class="year-btn" style="padding:4px 10px;font-size:12px" onclick="chDietM(1)">‚ñ∂</button>
          </div>
          <div class="diet-cal-header">
            <div class="diet-cal-dow">Lu</div><div class="diet-cal-dow">Ma</div>
            <div class="diet-cal-dow">Mi</div><div class="diet-cal-dow">Ju</div>
            <div class="diet-cal-dow">Vi</div><div class="diet-cal-dow">S√°</div>
            <div class="diet-cal-dow">Do</div>
          </div>
          <div class="diet-cal-grid" id="d-cal"></div>
        </div>
        <div class="card"><h2>Historial</h2><div class="log-list" id="d-list"></div></div>
      </div>
    </div>
  </div>

  <div class="footer">Datos guardados autom√°ticamente en tu navegador ‚úì</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<script>
// ‚ïê‚ïê CONSTANTS ‚ïê‚ïê
const MONTHS   = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
const DOW      = ["Lu","Ma","Mi","Ju","Vi","S√°","Do"];
const DAY_NAMES= ["Lunes","Martes","Mi√©rcoles","Jueves","Viernes","S√°bado","Domingo"];
const CYCLE    = [null,"green","yellow","red"];
const K        = { gym:"gt-gym", w:"gt-weight", d:"gt-diet", th:"gt-theme", pay:"gt-pay", rut:"gt-rutina" };
const RECUR_LABEL = {none:"Una sola vez",monthly:"Mensual",bimonthly:"Cada 2 meses",yearly:"Anual"};

// ‚ïê‚ïê STATE ‚ïê‚ïê
let gymD={}, wD=[], dD={}, payD=[], rutD={};
let gYear=new Date().getFullYear();
let dYear=new Date().getFullYear(), dMonth=new Date().getMonth();
let dStatus=null, selectedRecur="none";
let wChart=null, editingDay=0;

// ‚ïê‚ïê STORAGE ‚ïê‚ïê
function load(){
  try{gymD=JSON.parse(localStorage.getItem(K.gym)||"{}");}catch(_){}
  try{wD=JSON.parse(localStorage.getItem(K.w)||"[]");}catch(_){}
  try{dD=JSON.parse(localStorage.getItem(K.d)||"{}");}catch(_){}
  try{payD=JSON.parse(localStorage.getItem(K.pay)||"[]");}catch(_){}
  try{rutD=JSON.parse(localStorage.getItem(K.rut)||"{}");}catch(_){}
  applyTheme(localStorage.getItem(K.th)||"dark");
}
function sv(k,v){localStorage.setItem(k,JSON.stringify(v));}
function daysIn(y,m){return new Date(y,m+1,0).getDate();}
function firstDay(y,m){let d=new Date(y,m,1).getDay();return d===0?6:d-1;}

// ‚ïê‚ïê THEME ‚ïê‚ïê
function applyTheme(th){
  document.documentElement.setAttribute("data-theme",th);
  localStorage.setItem(K.th,th);
  document.getElementById("th-dark").classList.toggle("active",th==="dark");
  document.getElementById("th-light").classList.toggle("active",th==="light");
}
function toggleTheme(){
  applyTheme(document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark");
  renderWChart();
}

// ‚ïê‚ïê TABS ‚ïê‚ïê
function showTab(t){
  ["gym","rutina","pagos","peso","dieta"].forEach(s=>{
    document.getElementById("sec-"+s).classList.toggle("active",s===t);
  });
  document.querySelectorAll(".tab-btn").forEach((b,i)=>{
    b.classList.toggle("active",["gym","rutina","pagos","peso","dieta"][i]===t);
  });
  if(t==="peso")   renderW();
  if(t==="dieta")  renderD();
  if(t==="pagos")  renderPayments();
  if(t==="rutina") renderRutina();
}

// ‚ïê‚ïê PAYMENT ALERTS ‚ïê‚ïê
function getDaysUntil(dateStr){
  const t=new Date(); t.setHours(0,0,0,0);
  return Math.round((new Date(dateStr+"T00:00:00")-t)/(864e5));
}

function nextOccurrence(dateStr,recur){
  const today=new Date(); today.setHours(0,0,0,0);
  let d=new Date(dateStr+"T00:00:00");
  if(recur==="none") return d;
  while(d<today){
    if(recur==="monthly")      d.setMonth(d.getMonth()+1);
    else if(recur==="bimonthly") d.setMonth(d.getMonth()+2);
    else if(recur==="yearly")  d.setFullYear(d.getFullYear()+1);
    else break;
  }
  return d;
}

function checkPaymentAlerts(){
  if(payD.length===0) return;
  const urgent=[], soon=[];
  payD.forEach(p=>{
    const next=nextOccurrence(p.date,p.recur);
    const days=getDaysUntil(next.toISOString().split("T")[0]);
    if(days<=0)  urgent.push({...p,days,nextDate:next});
    else if(days<=7) soon.push({...p,days,nextDate:next});
  });

  // Red dot on tab
  const tabPayos=document.getElementById("tab-pagos");
  let badge=tabPayos.querySelector(".tab-badge");
  if(urgent.length>0||soon.length>0){
    if(!badge){badge=document.createElement("span");badge.className="tab-badge";tabPayos.appendChild(badge);}
  } else if(badge) badge.remove();

  if(urgent.length>0){
    // Show modal for urgent
    const items=urgent.map(p=>{
      const [y,m,d]=p.nextDate.toISOString().split("T")[0].split("-");
      return `<div class="modal-pay-item danger">
        <div><div class="modal-pay-name">${p.name}</div><div class="modal-pay-meta">${p.days===0?"Vence hoy":"Venci√≥ hace "+Math.abs(p.days)+" d√≠a"+(Math.abs(p.days)>1?"s":"")}</div></div>
        <div class="modal-pay-right">
          ${p.amount?`<div class="modal-pay-amount" style="color:var(--danger)">${p.currency||"$"}${p.amount}</div>`:""}
          <span class="modal-pay-badge danger">${p.days===0?"¬°Hoy!":"Vencido"}</span>
        </div>
      </div>`;
    }).join("");
    document.getElementById("modal-icon").textContent="üö®";
    document.getElementById("modal-title").textContent="¬°PAGO PENDIENTE!";
    document.getElementById("modal-subtitle").textContent="Ten√©s "+urgent.length+" pago"+(urgent.length>1?"s que vencieron o vencen hoy":" que vence hoy")+".";
    document.getElementById("modal-pay-list").innerHTML=items;
    document.getElementById("pay-modal").classList.add("open");

    // Also show banner
    showBanner("danger","üö®","¬°"+urgent.length+" pago"+(urgent.length>1?"s pendientes":"" )+" pendiente!",
      urgent.map(p=>p.name).join(", "));
  } else if(soon.length>0){
    showBanner("warn","‚ö†Ô∏è","Pr√≥ximo pago en "+soon[0].days+" d√≠a"+(soon[0].days>1?"s":""),
      soon.map(p=>`${p.name}${p.amount?" ¬∑ "+( p.currency||"$")+p.amount:""}`).join("  ¬∑  "));
  }
}

function showBanner(type,icon,title,body){
  const el=document.getElementById("global-alert");
  el.className=type;
  document.getElementById("alert-icon").textContent=icon;
  document.getElementById("alert-title").textContent=title;
  document.getElementById("alert-body").textContent=body;
  el.style.display="flex";
  document.getElementById("app-content").style.marginTop=el.offsetHeight+"px";
}

function closeAlert(){
  const el=document.getElementById("global-alert");
  el.style.display="none";
  document.getElementById("app-content").style.marginTop="0";
}

function closeModal(){
  document.getElementById("pay-modal").classList.remove("open");
}

// ‚ïê‚ïê PAYMENTS ‚ïê‚ïê
function selRecur(val,btn){
  selectedRecur=val;
  document.querySelectorAll(".recur-btn").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
}

function addPayment(){
  const name=document.getElementById("pay-name").value.trim();
  const amount=parseFloat(document.getElementById("pay-amount").value)||0;
  const currency=document.getElementById("pay-currency").value.trim()||"$";
  const date=document.getElementById("pay-date").value;
  const notes=document.getElementById("pay-notes").value.trim();
  if(!name||!date){alert("Complet√° el nombre y la fecha.");return;}
  payD.push({id:Date.now(),name,amount,currency,date,recur:selectedRecur,notes});
  sv(K.pay,payD);
  document.getElementById("pay-name").value="";
  document.getElementById("pay-amount").value="";
  document.getElementById("pay-notes").value="";
  // Reset recur
  selectedRecur="none";
  document.querySelectorAll(".recur-btn").forEach((b,i)=>b.classList.toggle("active",i===0));
  renderPayments();
  checkPaymentAlerts();
}

function deletePayment(id){
  payD=payD.filter(p=>p.id!==id);
  sv(K.pay,payD);
  renderPayments();
  checkPaymentAlerts();
}

function markPaid(id){
  const p=payD.find(x=>x.id===id);
  if(!p) return;
  if(p.recur==="none"){ deletePayment(id); return; }
  const next=nextOccurrence(p.date,p.recur);
  if(p.recur==="monthly")      next.setMonth(next.getMonth()+1);
  else if(p.recur==="bimonthly") next.setMonth(next.getMonth()+2);
  else if(p.recur==="yearly")  next.setFullYear(next.getFullYear()+1);
  p.date=next.toISOString().split("T")[0];
  sv(K.pay,payD);
  renderPayments();
  checkPaymentAlerts();
}

function renderPayments(){
  const list=document.getElementById("pay-list");
  if(payD.length===0){
    list.innerHTML='<div style="color:var(--text3);font-size:12px;text-align:center;padding:20px">Sin pagos registrados a√∫n</div>';
    return;
  }
  const sorted=[...payD]
    .map(p=>({...p,nextDate:nextOccurrence(p.date,p.recur)}))
    .sort((a,b)=>a.nextDate-b.nextDate);

  list.innerHTML=sorted.map(p=>{
    const days=getDaysUntil(p.nextDate.toISOString().split("T")[0]);
    const [y,m,d]=p.nextDate.toISOString().split("T")[0].split("-");
    const dateStr=`${d}/${m}/${y}`;
    let itemCls="",badgeCls="ok",badgeTxt="";
    if(days<0)       {itemCls="urgent";badgeCls="danger";badgeTxt=`Venci√≥ hace ${Math.abs(days)}d`;}
    else if(days===0){itemCls="urgent";badgeCls="danger";badgeTxt="¬°Hoy!";}
    else if(days<=7) {itemCls="soon";  badgeCls="warn";  badgeTxt=`En ${days} d√≠as`;}
    else             {itemCls="";      badgeCls="ok";    badgeTxt=`En ${days} d√≠as`;}
    return `<div class="pay-item ${itemCls}">
      <div class="pay-left">
        <div class="pay-name">${p.name}</div>
        <div class="pay-meta">üìÖ ${dateStr} &nbsp;¬∑&nbsp; ${RECUR_LABEL[p.recur]||p.recur}</div>
        ${p.notes?`<div class="pay-meta">üìù ${p.notes}</div>`:""}
      </div>
      <div class="pay-right">
        ${p.amount?`<span class="pay-amount">${p.currency}${p.amount}</span>`:""}
        <span class="pay-badge ${badgeCls}">${badgeTxt}</span>
        <div class="pay-actions">
          <button class="btn-paid" onclick="markPaid(${p.id})">‚úì Pagado</button>
          <button class="btn-del"  onclick="deletePayment(${p.id})">‚úï</button>
        </div>
      </div>
    </div>`;
  }).join("");
}

// ‚ïê‚ïê RUTINA ‚ïê‚ïê
function todayDayIdx(){ const d=new Date().getDay(); return d===0?6:d-1; }
function renderRutina(){
  const ti=todayDayIdx();
  document.getElementById("today-day-name").textContent=DAY_NAMES[ti];
  const exs=rutD[ti]||[];
  const exBox=document.getElementById("today-exercises");
  exBox.innerHTML=exs.length===0
    ?'<div style="color:var(--text3);font-size:13px">No ten√©s ejercicios para hoy. Configur√° tu rutina abajo üëá</div>'
    :`<div class="exercise-list">${exs.map((e,i)=>`<div class="exercise-chip"><span class="ex-num">${i+1}.</span>${e}</div>`).join("")}</div>`;
  const tabs=document.getElementById("day-tabs");
  tabs.innerHTML=DAY_NAMES.map((n,i)=>`<button class="day-tab${i===editingDay?" active":""}" onclick="selectEditDay(${i})">${n.slice(0,3)}</button>`).join("");
  renderDayEditor();
  renderFullWeek();
}
function selectEditDay(i){ editingDay=i; renderRutina(); }
function renderDayEditor(){
  document.getElementById("editing-day-label").textContent=`Ejercicios del ${DAY_NAMES[editingDay]}:`;
  const exs=rutD[editingDay]||[];
  const ed=document.getElementById("exercise-editor");
  ed.innerHTML=exs.length===0
    ?'<div style="color:var(--text3);font-size:12px;padding:8px">Sin ejercicios. Agreg√° uno abajo.</div>'
    :exs.map((e,i)=>`<div class="ex-row"><span class="ex-num" style="color:var(--accent);min-width:20px;font-size:12px">${i+1}.</span><input class="form-input" value="${e.replace(/"/g,'&quot;')}" onchange="updateExercise(${i},this.value)" style="flex:1"/><button class="btn-del" onclick="removeExercise(${i})">‚úï</button></div>`).join("");
}
function addExercise(){
  const inp=document.getElementById("new-ex-input");
  const val=inp.value.trim(); if(!val)return;
  if(!rutD[editingDay])rutD[editingDay]=[];
  rutD[editingDay].push(val); sv(K.rut,rutD); inp.value=""; renderRutina();
}
function updateExercise(idx,val){ if(rutD[editingDay])rutD[editingDay][idx]=val; sv(K.rut,rutD); }
function removeExercise(idx){ if(rutD[editingDay])rutD[editingDay].splice(idx,1); sv(K.rut,rutD); renderRutina(); }
function renderFullWeek(){
  document.getElementById("full-week").innerHTML=DAY_NAMES.map((n,i)=>{
    const exs=rutD[i]||[], isToday=i===todayDayIdx();
    return `<div style="background:var(--bg3);border-radius:10px;padding:12px 14px;border:1px solid ${isToday?"var(--accent)":"var(--border)"}">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:${exs.length?8:0}px">
        <span style="font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:1px;color:${isToday?"var(--accent)":"var(--text)"}">${n}</span>
        ${isToday?'<span style="font-size:10px;background:var(--accent-bg);color:var(--accent);padding:2px 8px;border-radius:20px">HOY</span>':""}
        <span style="margin-left:auto;font-size:11px;color:var(--text3)">${exs.length?exs.length+" ejercicio"+(exs.length>1?"s":""):"Descanso"}</span>
      </div>
      ${exs.length?`<div style="display:flex;flex-direction:column;gap:4px">${exs.map(e=>`<div style="font-size:12px;color:var(--text2)">‚Ä¢ ${e}</div>`).join("")}</div>`:""}
    </div>`;
  }).join("");
}

// ‚ïê‚ïê PESO ‚ïê‚ïê
function addWeight(){
  const date=document.getElementById("w-date").value;
  const kg=parseFloat(document.getElementById("w-kg").value);
  const note=document.getElementById("w-note").value.trim();
  if(!date||isNaN(kg)){alert("Complet√° la fecha y el peso.");return;}
  wD=wD.filter(e=>e.date!==date); wD.push({date,kg,note});
  wD.sort((a,b)=>a.date.localeCompare(b.date));
  sv(K.w,wD); document.getElementById("w-kg").value=""; document.getElementById("w-note").value="";
  renderW();
}
function delWeight(date){wD=wD.filter(e=>e.date!==date);sv(K.w,wD);renderW();}
function renderW(){
  const list=document.getElementById("w-list"); list.innerHTML="";
  if(wD.length===0){ list.innerHTML='<div style="color:var(--text3);font-size:12px;text-align:center;padding:16px">Sin registros a√∫n</div>'; }
  else { [...wD].reverse().forEach(e=>{ const[y,m,d]=e.date.split("-"); const item=document.createElement("div"); item.className="log-item"; item.innerHTML=`<div class="log-item-left"><span class="log-val">${e.kg} kg</span>${e.note?`<span class="log-note">${e.note}</span>`:""}<span class="log-date">${d}/${m}/${y}</span></div><button class="btn-del" onclick="delWeight('${e.date}')">‚úï</button>`; list.appendChild(item); }); }
  if(wD.length>0){
    const kgs=wD.map(e=>e.kg),cur=wD[wD.length-1].kg;
    document.getElementById("w-cur").textContent=cur;
    document.getElementById("w-min").textContent=Math.min(...kgs);
    document.getElementById("w-max").textContent=Math.max(...kgs);
    if(wD.length>=2){ const diff=(cur-wD[0].kg).toFixed(1),c=diff<0?"#22c55e":diff>0?"#ef4444":"#eab308"; document.getElementById("w-change").innerHTML=`Cambio total: <span style="color:${c}">${diff>0?"+":""}${diff} kg</span>`; }
    else document.getElementById("w-change").textContent="";
  } else { ["w-cur","w-min","w-max"].forEach(id=>document.getElementById(id).textContent="‚Äî"); document.getElementById("w-change").textContent=""; }
  renderWChart();
}
function renderWChart(){
  const dark=document.documentElement.getAttribute("data-theme")==="dark";
  const gc=dark?"#ffffff18":"#00000012",tc=dark?"#888":"#666";
  if(wChart){wChart.destroy();wChart=null;}
  const ctx=document.getElementById("wChart"); if(!ctx)return;
  wChart=new Chart(ctx,{type:"line",data:{labels:wD.map(e=>{const[y,m,d]=e.date.split("-");return`${d}/${m}`;}),datasets:[{data:wD.map(e=>e.kg),borderColor:"#a0a0ff",backgroundColor:"rgba(160,160,255,0.12)",borderWidth:2,pointBackgroundColor:"#a0a0ff",pointRadius:4,tension:0.3,fill:true}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{ticks:{color:tc,font:{size:10}},grid:{color:gc}},y:{ticks:{color:tc,font:{size:10}},grid:{color:gc}}}}});
}

// ‚ïê‚ïê DIETA ‚ïê‚ïê
function selDS(s){ dStatus=s; ["green","yellow","red"].forEach(c=>{document.getElementById("dsb-"+c).className="diet-status-btn"+(c===s?" sel-"+c:"");}); }
function chDietY(d){ dYear+=d; renderDStats(); document.getElementById("d-year").textContent=dYear; }
function chDietM(d){ dMonth+=d; if(dMonth<0){dMonth=11;dYear--;} if(dMonth>11){dMonth=0;dYear++;} renderDCal(); }
function addDiet(){
  const date=document.getElementById("d-date").value;
  const food=document.getElementById("d-food").value.trim();
  const notes=document.getElementById("d-notes").value.trim();
  if(!date){alert("Seleccion√° una fecha.");return;}
  if(!dStatus){alert("Seleccion√° si seguiste la dieta.");return;}
  dD[date]={status:dStatus,food,notes}; sv(K.d,dD);
  document.getElementById("d-food").value=""; document.getElementById("d-notes").value="";
  dStatus=null; ["green","yellow","red"].forEach(c=>document.getElementById("dsb-"+c).className="diet-status-btn");
  renderD();
}
function delDiet(date){delete dD[date];sv(K.d,dD);renderD();}
function renderD(){ document.getElementById("d-year").textContent=dYear; renderDStats();renderDCal();renderDList(); }
function renderDStats(){
  let g=0,y=0,r=0;
  for(const[k,v]of Object.entries(dD)){ if(!k.startsWith(dYear+"-"))continue; if(v.status==="green")g++;else if(v.status==="yellow")y++;else if(v.status==="red")r++; }
  document.getElementById("ds-g").textContent=g; document.getElementById("ds-y").textContent=y; document.getElementById("ds-r").textContent=r;
}
function renderDCal(){
  document.getElementById("d-month-lbl").textContent=`${MONTHS[dMonth]} ${dYear}`;
  const grid=document.getElementById("d-cal"); grid.innerHTML="";
  const days=daysIn(dYear,dMonth),first=firstDay(dYear,dMonth);
  for(let i=0;i<first;i++){const e=document.createElement("div");e.className="diet-dot";e.style.opacity="0";grid.appendChild(e);}
  for(let d=1;d<=days;d++){
    const key=`${dYear}-${String(dMonth+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
    const entry=dD[key]; const dot=document.createElement("div");
    dot.className="diet-dot"+(entry?" "+entry.status:"");
    dot.title=entry?`${d}: ${entry.status==="green"?"‚úÖ Completa":entry.status==="yellow"?"‚ö° A medias":"‚ùå No segu√≠"}${entry.food?"\nüçΩ "+entry.food:""}`:String(d);
    grid.appendChild(dot);
  }
}
function renderDList(){
  const list=document.getElementById("d-list"); list.innerHTML="";
  const entries=Object.entries(dD).sort((a,b)=>b[0].localeCompare(a[0])).slice(0,40);
  if(entries.length===0){list.innerHTML='<div style="color:var(--text3);font-size:12px;text-align:center;padding:16px">Sin registros a√∫n</div>';return;}
  entries.forEach(([date,v])=>{
    const[y,m,d]=date.split("-");
    const bl={green:"‚úÖ Completa",yellow:"‚ö° A medias",red:"‚ùå No segu√≠"}[v.status];
    const item=document.createElement("div"); item.className="diet-log-item";
    item.innerHTML=`<div class="diet-log-header"><span class="diet-log-date">${d}/${m}/${y}</span><div style="display:flex;align-items:center;gap:8px"><span class="diet-badge ${v.status}">${bl}</span><button class="btn-del" onclick="delDiet('${date}')">‚úï</button></div></div>${v.food?`<div class="diet-log-food">üçΩ ${v.food}</div>`:""}${v.notes?`<div class="diet-log-notes">üìù ${v.notes}</div>`:""}`;
    list.appendChild(item);
  });
}

// ‚ïê‚ïê GYM ‚ïê‚ïê
function changeYear(d){gYear+=d;renderGym();}
function toggleDay(m,d){
  const k=`${gYear}-${m}-${d}`;
  const cur=gymD[k]??null, next=CYCLE[(CYCLE.indexOf(cur)+1)%CYCLE.length];
  if(next===null)delete gymD[k]; else gymD[k]=next;
  sv(K.gym,gymD); renderGym();
}
function renderGym(){
  document.getElementById("year-display").textContent=gYear;
  const today=new Date(); let g=0,y=0,r=0;
  for(const[k,v]of Object.entries(gymD)){ if(!k.startsWith(gYear+"-"))continue; if(v==="green")g++;else if(v==="yellow")y++;else if(v==="red")r++; }
  document.getElementById("sg").textContent=g; document.getElementById("sy").textContent=y; document.getElementById("sr").textContent=r;
  const grid=document.getElementById("months-grid"); grid.innerHTML="";
  MONTHS.forEach((mn,mi)=>{
    const days=daysIn(gYear,mi),first=firstDay(gYear,mi);
    const isCur=today.getFullYear()===gYear&&today.getMonth()===mi;
    let mg=0,my=0,mr=0;
    for(let d=1;d<=days;d++){const s=gymD[`${gYear}-${mi}-${d}`];if(s==="green")mg++;else if(s==="yellow")my++;else if(s==="red")mr++;}
    let mini="";
    if(mg>0)mini+=`<span style="color:#22c55e">üí™${mg}</span>`;
    if(my>0)mini+=`<span style="color:#eab308"> üòÖ${my}</span>`;
    if(mr>0)mini+=`<span style="color:#ef4444"> ‚ùå${mr}</span>`;
    const card=document.createElement("div"); card.className="month-card"+(isCur?" current":"");
    card.innerHTML=`<div class="month-header"><div><div class="month-name${isCur?" current-name":""}">${mn}</div><div class="month-mini-stats">${mini}</div></div>${isCur?'<span class="current-badge">HOY</span>':""}</div><div class="dow-header">${DOW.map(d=>`<div class="dow-cell">${d}</div>`).join("")}</div><div class="days-grid" id="dg-${mi}"></div>`;
    grid.appendChild(card);
    const dg=document.getElementById(`dg-${mi}`);
    for(let i=0;i<first;i++){const e=document.createElement("div");e.className="day-cell empty";dg.appendChild(e);}
    for(let d=1;d<=days;d++){
      const key=`${gYear}-${mi}-${d}`,st=gymD[key]??null,isT=isCur&&today.getDate()===d;
      const cell=document.createElement("div");
      cell.className="day-cell"+(st?" "+st:"")+(isT?" today":"");
      cell.textContent=d; cell.title=st?({green:"Fui üí™",yellow:"A medias üòÖ",red:"No fui ‚ùå"}[st]):"Sin marcar";
      cell.addEventListener("click",()=>toggleDay(mi,d)); dg.appendChild(cell);
    }
  });
}

// ‚ïê‚ïê INIT ‚ïê‚ïê
const todayStr=new Date().toISOString().split("T")[0];
load();
document.getElementById("w-date").value=todayStr;
document.getElementById("d-date").value=todayStr;
document.getElementById("pay-date").value=todayStr;
editingDay=todayDayIdx();
renderGym();
// Check alerts after a short delay so the page renders first
setTimeout(checkPaymentAlerts, 300);
</script>
</body>
</html>
